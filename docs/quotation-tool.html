<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>견적 시뮬레이터 - 워크위드 내부용</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f7fa; color: #333;
            font-size: 14px; line-height: 1.6;
            letter-spacing: -0.02em;
        }

        /* 상단 헤더 */
        .app-header {
            background: #1a365d; color: #fff;
            padding: 16px 30px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }
        .app-header h1 { font-size: 18px; font-weight: 600; letter-spacing: 1px; }
        .app-header .sub { font-size: 11px; color: rgba(255,255,255,0.5); margin-left: 12px; }
        .header-actions { display: flex; gap: 10px; }
        .header-actions button {
            background: rgba(255,255,255,0.15); color: #fff; border: 1px solid rgba(255,255,255,0.2);
            padding: 6px 14px; border-radius: 6px; font-size: 12px; cursor: pointer;
            font-family: inherit; transition: all 0.2s;
        }
        .header-actions button:hover { background: rgba(255,255,255,0.25); }

        /* 탭 네비게이션 */
        .tab-nav {
            background: #fff; border-bottom: 1px solid #e2e8f0;
            padding: 0 30px; display: flex; gap: 0;
            position: sticky; top: 54px; z-index: 99;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .tab-btn {
            padding: 14px 20px; border: none; background: none;
            font-family: inherit; font-size: 13px; color: #718096;
            cursor: pointer; border-bottom: 3px solid transparent;
            transition: all 0.2s; white-space: nowrap;
        }
        .tab-btn:hover { color: #1a365d; background: #f7fafc; }
        .tab-btn.active {
            color: #1a365d; font-weight: 600;
            border-bottom-color: #1a365d;
        }
        .tab-btn .tab-num {
            display: inline-block; background: #e2e8f0; color: #718096;
            width: 20px; height: 20px; border-radius: 50%; text-align: center;
            line-height: 20px; font-size: 10px; margin-right: 6px;
            font-weight: 600;
        }
        .tab-btn.active .tab-num { background: #1a365d; color: #fff; }
        .tab-btn.done .tab-num { background: #38a169; color: #fff; }

        /* 메인 콘텐츠 */
        .main { max-width: 900px; margin: 0 auto; padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* 카드 */
        .card {
            background: #fff; border-radius: 10px;
            padding: 28px; margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e8ecf1;
        }
        .card-title {
            font-size: 16px; font-weight: 600; color: #1a365d;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid #edf2f7;
        }

        /* 폼 요소 */
        .form-group { margin-bottom: 16px; }
        .form-label {
            display: block; font-size: 12px; font-weight: 600;
            color: #4a5568; margin-bottom: 6px;
        }
        .form-label .hint { font-weight: 400; color: #a0aec0; margin-left: 6px; }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%; padding: 10px 14px; border: 1px solid #e2e8f0;
            border-radius: 8px; font-family: inherit; font-size: 14px;
            color: #333; background: #fff; transition: border-color 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: #1a365d;
            box-shadow: 0 0 0 3px rgba(26,54,93,0.1);
        }
        textarea { resize: vertical; min-height: 60px; }

        .form-row { display: flex; gap: 16px; }
        .form-row .form-group { flex: 1; }

        /* 라디오/체크박스 그룹 */
        .option-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .option-btn {
            padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 8px;
            background: #fff; cursor: pointer; font-size: 13px;
            transition: all 0.2s; font-family: inherit;
        }
        .option-btn:hover { border-color: #1a365d; }
        .option-btn.selected {
            background: #1a365d; color: #fff; border-color: #1a365d;
        }

        /* 결과 박스 */
        .result-box {
            background: #f0f5ff; border: 1px solid #bee3f8;
            border-radius: 10px; padding: 20px; margin-top: 16px;
        }
        .result-box.warning {
            background: #fffaf0; border-color: #fbd38d;
        }
        .result-box.success {
            background: #f0fff4; border-color: #9ae6b4;
        }
        .result-title {
            font-size: 13px; font-weight: 600; color: #2b6cb0;
            margin-bottom: 10px;
        }
        .result-box.warning .result-title { color: #c05621; }
        .result-box.success .result-title { color: #276749; }
        .result-value {
            font-size: 28px; font-weight: 700; color: #1a365d;
        }
        .result-sub { font-size: 12px; color: #718096; margin-top: 4px; }

        /* 테이블 */
        .data-table { width: 100%; border-collapse: collapse; margin: 12px 0; }
        .data-table th {
            background: #f7fafc; padding: 10px 14px; text-align: left;
            font-size: 12px; font-weight: 600; color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
        }
        .data-table td {
            padding: 10px 14px; border-bottom: 1px solid #edf2f7;
            font-size: 13px;
        }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table .num { text-align: right; font-variant-numeric: tabular-nums; }
        .data-table .highlight { color: #1a365d; font-weight: 600; }
        .data-table .danger { color: #e53e3e; }
        .data-table .safe { color: #38a169; }
        .data-table tfoot td {
            font-weight: 600; border-top: 2px solid #1a365d;
            background: #f7fafc;
        }

        /* 시뮬레이션 시나리오 카드 */
        .scenario-cards { display: flex; gap: 16px; margin-top: 16px; }
        .scenario-card {
            flex: 1; border-radius: 10px; padding: 20px;
            border: 2px solid #e2e8f0; text-align: center;
            transition: all 0.2s;
        }
        .scenario-card.primary { border-color: #1a365d; background: #f0f5ff; }
        .scenario-card.secondary { border-color: #ed8936; background: #fffaf0; }
        .scenario-card.danger { border-color: #e53e3e; background: #fff5f5; }
        .scenario-label { font-size: 11px; font-weight: 600; color: #718096; margin-bottom: 8px; letter-spacing: 1px; }
        .scenario-card.primary .scenario-label { color: #1a365d; }
        .scenario-card.secondary .scenario-label { color: #c05621; }
        .scenario-card.danger .scenario-label { color: #e53e3e; }
        .scenario-amount { font-size: 24px; font-weight: 700; color: #333; margin-bottom: 4px; }
        .scenario-detail { font-size: 12px; color: #718096; }
        .scenario-input {
            width: 80px; text-align: center; border: 1px solid #e2e8f0;
            border-radius: 6px; padding: 4px; font-size: 14px; font-weight: 600;
            margin: 0 4px; font-family: inherit;
        }

        /* 체크리스트 */
        .checklist { list-style: none; }
        .checklist li {
            padding: 14px 16px; border-bottom: 1px solid #edf2f7;
            display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: background 0.15s; border-radius: 6px;
        }
        .checklist li:hover { background: #f7fafc; }
        .checklist li.checked { opacity: 0.6; }
        .checklist li.checked .check-text { text-decoration: line-through; }
        .check-box {
            width: 22px; height: 22px; border: 2px solid #cbd5e0;
            border-radius: 6px; display: flex; align-items: center;
            justify-content: center; flex-shrink: 0; transition: all 0.2s;
        }
        .checklist li.checked .check-box {
            background: #38a169; border-color: #38a169; color: #fff;
        }
        .check-text { font-size: 14px; }
        .check-step {
            font-size: 11px; font-weight: 600; color: #1a365d;
            background: #edf2f7; padding: 2px 8px; border-radius: 4px;
            margin-right: 4px;
        }

        /* 버튼 */
        .btn {
            padding: 12px 24px; border-radius: 8px; border: none;
            font-family: inherit; font-size: 14px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; display: inline-flex;
            align-items: center; gap: 8px;
        }
        .btn-primary { background: #1a365d; color: #fff; }
        .btn-primary:hover { background: #2d4a7a; }
        .btn-secondary { background: #edf2f7; color: #4a5568; }
        .btn-secondary:hover { background: #e2e8f0; }
        .btn-success { background: #38a169; color: #fff; }
        .btn-success:hover { background: #2f855a; }
        .btn-danger { background: #e53e3e; color: #fff; }
        .btn-danger:hover { background: #c53030; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }

        /* 진행 표시 */
        .progress-bar {
            height: 4px; background: #e2e8f0; border-radius: 2px;
            margin: 8px 0; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: #38a169; border-radius: 2px;
            transition: width 0.3s;
        }

        /* 알림 */
        .alert {
            padding: 12px 16px; border-radius: 8px; font-size: 13px;
            margin-bottom: 16px; display: flex; align-items: flex-start; gap: 8px;
        }
        .alert-info { background: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        .alert-warning { background: #fffaf0; color: #c05621; border: 1px solid #fbd38d; }
        .alert-danger { background: #fff5f5; color: #c53030; border: 1px solid #feb2b2; }

        /* 견적서 미리보기 */
        .preview-frame {
            background: #fff; border: 1px solid #e2e8f0;
            border-radius: 4px; padding: 0;
            max-height: 900px; overflow-y: auto;
        }
        .preview-frame iframe {
            width: 100%; height: 1800px; border: none;
        }

        /* 저장 상태 표시 */
        .save-indicator {
            font-size: 11px; color: rgba(255,255,255,0.6);
            display: flex; align-items: center; gap: 4px;
        }
        .save-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: #38a169;
        }

        /* 이력 모달 */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: #fff; border-radius: 12px; width: 90%; max-width: 700px;
            max-height: 80vh; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .modal-header {
            padding: 20px 24px; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h2 { font-size: 18px; font-weight: 600; color: #1a365d; }
        .modal-close { background: none; border: none; font-size: 22px; cursor: pointer; color: #718096; padding: 4px 8px; }
        .modal-body { padding: 20px 24px; overflow-y: auto; max-height: calc(80vh - 130px); }
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 14px 16px; border: 1px solid #e2e8f0; border-radius: 8px;
            margin-bottom: 8px; cursor: pointer; transition: all 0.15s;
        }
        .history-item:hover { background: #f7fafc; border-color: #1a365d; }
        .history-info { flex: 1; }
        .history-client { font-weight: 600; color: #1a365d; font-size: 14px; }
        .history-meta { font-size: 12px; color: #718096; margin-top: 2px; }
        .history-amount { font-weight: 700; color: #1a365d; font-size: 15px; text-align: right; min-width: 120px; }
        .history-actions { display: flex; gap: 6px; margin-left: 12px; }
        .history-actions button {
            padding: 4px 10px; border-radius: 4px; border: 1px solid #e2e8f0;
            background: #fff; font-size: 11px; cursor: pointer; font-family: inherit;
        }
        .history-actions .btn-load { color: #1a365d; border-color: #1a365d; }
        .history-actions .btn-load:hover { background: #1a365d; color: #fff; }
        .history-actions .btn-del { color: #e53e3e; border-color: #e53e3e; }
        .history-actions .btn-del:hover { background: #e53e3e; color: #fff; }
        .history-empty { text-align: center; color: #a0aec0; padding: 40px; font-size: 14px; }
        .history-badge {
            display: inline-block; padding: 2px 8px; border-radius: 10px;
            font-size: 10px; font-weight: 600; margin-left: 6px;
        }
        .badge-win { background: #c6f6d5; color: #276749; }
        .badge-loss { background: #fed7d7; color: #9b2c2c; }
        .badge-pending { background: #fefcbf; color: #975a16; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid #e2e8f0; text-align: right; }

        /* 요율 설정 토글 */
        .rate-toggle {
            font-size: 12px; color: #2b6cb0; cursor: pointer; margin-left: 8px;
            border: none; background: none; font-family: inherit; text-decoration: underline;
        }
        .rate-settings { display: none; margin-top: 12px; }
        .rate-settings.open { display: block; }
        .rate-row {
            display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
        }
        .rate-item {
            display: flex; align-items: center; gap: 4px; font-size: 12px; color: #4a5568;
        }
        .rate-item input {
            width: 65px; text-align: center; padding: 4px 6px; font-size: 12px;
            border: 1px solid #e2e8f0; border-radius: 4px;
        }

        /* 견적 유형 선택 */
        .type-selector {
            display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;
        }
        .type-card {
            flex: 1; min-width: 140px; padding: 16px; border: 2px solid #e2e8f0;
            border-radius: 10px; cursor: pointer; text-align: center;
            transition: all 0.2s; background: #fff;
        }
        .type-card:hover { border-color: #1a365d; background: #f7fafc; }
        .type-card.selected { border-color: #1a365d; background: #f0f5ff; }
        .type-card .type-icon { font-size: 24px; margin-bottom: 6px; }
        .type-card .type-name { font-size: 13px; font-weight: 600; color: #1a365d; }
        .type-card .type-desc { font-size: 11px; color: #718096; margin-top: 4px; }

        /* 유형별 표시/숨김 */
        .for-outsource, .for-labor, .for-cs-agent, .for-cs-share, .for-recruit, .for-dispatch { display: none; }
        body.qt-outsource .for-outsource { display: block; }
        body.qt-labor .for-labor { display: block; }
        body.qt-cs-agent .for-cs-agent { display: block; }
        body.qt-cs-share .for-cs-share { display: block; }
        body.qt-recruit .for-recruit { display: block; }
        body.qt-dispatch .for-dispatch { display: block; }
        /* flex 복원 */
        body.qt-outsource .for-outsource.d-flex { display: flex; }
        body.qt-labor .for-labor.d-flex { display: flex; }
        body.qt-cs-agent .for-cs-agent.d-flex { display: flex; }
        body.qt-cs-share .for-cs-share.d-flex { display: flex; }
        body.qt-recruit .for-recruit.d-flex { display: flex; }
        body.qt-dispatch .for-dispatch.d-flex { display: flex; }
        /* 공통 표시 (정액/일반 도급/파견 공유) */
        .for-dogup { display: none; }
        body.qt-outsource .for-dogup, body.qt-labor .for-dogup, body.qt-dispatch .for-dogup { display: block; }
        body.qt-outsource .for-dogup.d-flex, body.qt-labor .for-dogup.d-flex, body.qt-dispatch .for-dogup.d-flex { display: flex; }
        /* CS 공통 (CS대행+쉐어링) */
        .for-cs { display: none; }
        body.qt-cs-agent .for-cs, body.qt-cs-share .for-cs { display: block; }

        /* 인쇄 숨김 */
        @media print { body > *:not(.print-target) { display: none !important; } }

        /* 반응형 */
        @media (max-width: 768px) {
            .form-row { flex-direction: column; gap: 0; }
            .scenario-cards { flex-direction: column; }
            .tab-nav { overflow-x: auto; }
            .main { padding: 16px; }
        }
    </style>
</head>
<body>

<!-- ===== 상단 헤더 ===== -->
<div class="app-header">
    <div style="display:flex; align-items:center;">
        <h1 style="cursor:pointer;" onclick="switchTab(0); window.scrollTo(0,0);">견적 시뮬레이터</h1>
        <span class="sub">워크위드 내부용 v3.0</span>
    </div>
    <div style="display:flex;align-items:center;gap:16px;">
        <div class="save-indicator">
            <span class="save-dot"></span>
            <span id="saveStatus">자동 저장됨</span>
        </div>
        <div class="header-actions">
            <button onclick="sendToGoogleSheet()" oncontextmenu="event.preventDefault();openSheetModal();" title="클릭: 저장 | 우클릭: 설정" style="background:rgba(66,153,225,0.3);border-color:rgba(66,153,225,0.5);">구글시트 저장</button>
            <button onclick="showSheetHistory()" style="background:rgba(66,153,225,0.15);border-color:rgba(66,153,225,0.3);">구글시트 불러오기</button>
            <button onclick="saveToHistory()" style="background:rgba(56,161,105,0.3);border-color:rgba(56,161,105,0.5);">로컬저장</button>
            <button onclick="showHistory()">로컬이력</button>
            <button onclick="resetAll()">새 견적</button>
        </div>
    </div>
</div>

<!-- ===== 탭 네비게이션 ===== -->
<div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab(0)"><span class="tab-num">1</span>고객정보</button>
    <button class="tab-btn" onclick="switchTab(1)"><span class="tab-num">2</span>인원산출</button>
    <button class="tab-btn" onclick="switchTab(2)"><span class="tab-num">3</span>원가계산</button>
    <button class="tab-btn" onclick="switchTab(3)"><span class="tab-num">4</span>견적시뮬</button>
    <button class="tab-btn" onclick="switchTab(4)"><span class="tab-num">5</span>견적서생성</button>
    <button class="tab-btn" onclick="switchTab(5)"><span class="tab-num">6</span>체크리스트</button>
</div>

<!-- ===== 메인 ===== -->
<div class="main">

    <!-- ==================== 탭1: 고객정보 ==================== -->
    <div class="tab-content active" id="tab0">
        <div class="card">
            <div class="card-title">견적 유형 선택</div>
            <div class="type-selector">
                <div class="type-card selected" onclick="switchQuoteType('outsource', this)">
                    <div class="type-icon">🏢</div>
                    <div class="type-name">정액제 도급</div>
                    <div class="type-desc">월 총액 정액<br>(오토스테이 등)</div>
                </div>
                <div class="type-card" onclick="switchQuoteType('labor', this)">
                    <div class="type-icon">🏭</div>
                    <div class="type-name">일반 도급</div>
                    <div class="type-desc">1인 단가 × 인원<br>(제조/물류 등)</div>
                </div>
                <div class="type-card" onclick="switchQuoteType('cs-agent', this)">
                    <div class="type-icon">📞</div>
                    <div class="type-name">CS대행</div>
                    <div class="type-desc">전담 상담사 배치<br>(위드콜)</div>
                </div>
                <div class="type-card" onclick="switchQuoteType('cs-share', this)">
                    <div class="type-icon">📊</div>
                    <div class="type-name">CS쉐어링</div>
                    <div class="type-desc">콜 구간별 과금<br>(공유 상담)</div>
                </div>
                <div class="type-card" onclick="switchQuoteType('recruit', this)">
                    <div class="type-icon">🤝</div>
                    <div class="type-name">채용대행</div>
                    <div class="type-desc">인력 소개 수수료<br>(직무별 단가)</div>
                </div>
                <div class="type-card" onclick="switchQuoteType('dispatch', this)">
                    <div class="type-icon">👷</div>
                    <div class="type-name">파견</div>
                    <div class="type-desc">인력 파견 수수료<br>(1인 단가 × 인원)</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">고객 / 사업장 정보</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">업체명</label>
                    <input type="text" id="clientName" placeholder="예: 오토스테이" oninput="autoSave()">
                </div>
                <div class="form-group">
                    <label class="form-label">사업장명</label>
                    <input type="text" id="siteName" placeholder="예: 성수점" oninput="autoSave()">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">업종</label>
                    <select id="industry" onchange="onIndustryChange(); autoSave();">
                        <option value="">선택</option>
                        <option value="세차/주차">세차/주차</option>
                        <option value="물류/택배">물류/택배</option>
                        <option value="제조라인">제조 라인</option>
                        <option value="사무/행정">사무/행정</option>
                        <option value="CS/콜센터">CS/콜센터</option>
                        <option value="이커머스">이커머스</option>
                        <option value="경비/시설">경비/시설관리</option>
                        <option value="호텔/숙박">호텔/숙박</option>
                        <option value="식품제조">식품 제조</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">담당자</label>
                    <input type="text" id="contactName" placeholder="이름" oninput="autoSave()">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">연락처</label>
                    <input type="text" id="contactPhone" placeholder="010-0000-0000" oninput="autoSave()">
                </div>
                <div class="form-group">
                    <label class="form-label">이메일</label>
                    <input type="text" id="contactEmail" placeholder="email@example.com" oninput="autoSave()">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">유입 경로</label>
                <div class="option-group">
                    <button class="option-btn" onclick="selectOption(this,'source')">크몽</button>
                    <button class="option-btn" onclick="selectOption(this,'source')">소개</button>
                    <button class="option-btn" onclick="selectOption(this,'source')">구글광고</button>
                    <button class="option-btn" onclick="selectOption(this,'source')">네이버광고</button>
                    <button class="option-btn" onclick="selectOption(this,'source')">홈페이지</button>
                    <button class="option-btn" onclick="selectOption(this,'source')">기타</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">현재 운영 방식</label>
                <div class="option-group">
                    <button class="option-btn" id="btnCurrentOpsSelf" onclick="selectOption(this,'currentOps')">직접고용</button>
                    <button class="option-btn" onclick="selectOption(this,'currentOps')">타사 아웃소싱</button>
                    <button class="option-btn" onclick="selectOption(this,'currentOps')">신규 사업장</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">아웃소싱 검토 이유 <span class="hint">(추정)</span></label>
                <textarea id="reason" placeholder="관리 부담, 인력 수급 어려움, 신규 매장 등" oninput="autoSave()"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">특이사항 / 메모</label>
                <textarea id="memo" placeholder="채용공고 시급, 경쟁사 정보, 기타 참고사항" oninput="autoSave()"></textarea>
            </div>
        </div>

        <div id="industryTip" class="alert alert-info" style="display:none;"></div>

        <div class="btn-group" style="justify-content:flex-end;">
            <button class="btn btn-primary" onclick="switchTab(1)">다음: 인원산출 &rarr;</button>
        </div>
    </div>

    <!-- ==================== 탭2: 인원산출 ==================== -->
    <div class="tab-content" id="tab1">

        <!-- ===== CS대행 전용: 상담사 구성 ===== -->
        <div class="for-cs-agent">
            <div class="card">
                <div class="card-title">상담사 구성 (위드콜)</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">팀장 <span class="hint">(0이면 미배치)</span></label>
                        <input type="number" id="csLeaderCount" value="0" min="0" max="5" step="0.5" onchange="calcCSAgent(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">팀장 월급 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="csLeaderSalary" value="3,800,000" onchange="calcCSAgent(); autoSave();">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">선임 상담사 수</label>
                        <input type="number" id="csSeniorCount" value="1" min="0" max="20" step="0.5" onchange="calcCSAgent(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">선임 월급 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="csSeniorSalary" value="3,200,000" onchange="calcCSAgent(); autoSave();">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">일반 상담사 수</label>
                        <input type="number" id="csJuniorCount" value="1" min="0" max="20" step="0.5" onchange="calcCSAgent(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">일반 월급 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="csJuniorSalary" value="2,900,000" onchange="calcCSAgent(); autoSave();">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ASP 패키지 (인당/월)</label>
                        <input type="text" inputmode="numeric" data-money id="csASP" value="350,000" onchange="calcCSAgent(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">관리수수료 (%)</label>
                        <input type="number" id="csMgmtFee" value="8" step="1" min="0" max="30" onchange="calcCSAgent(); autoSave();">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">초기 구축비 (원) <span class="hint">1회성, 0이면 면제</span></label>
                        <input type="text" inputmode="numeric" data-money id="csSetupFee" value="1,000,000" onchange="autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">운영시간</label>
                        <input type="text" id="csOpTime" value="09:00~18:00 (휴게 1시간 제외)" oninput="autoSave();">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">인력 근무조건</label>
                    <input type="text" id="csWorkCond" value="평일 주간 일 8T" oninput="autoSave();">
                </div>

                <div class="form-group">
                    <label class="form-label">업무범위</label>
                    <textarea id="csWorkScope" rows="3" placeholder="예: CS관련 업무(인바운드) + 영업 문의 초기 대응" oninput="autoSave();">CS관련 업무(인바운드) + 영업 문의 초기 대응</textarea>
                </div>
            </div>

            <div class="card">
                <div class="card-title">CS대행 비용 산출</div>
                <table class="data-table">
                    <thead><tr><th>항목</th><th style="text-align:right;">단가</th><th style="text-align:right;">인원</th><th style="text-align:right;">합계</th></tr></thead>
                    <tbody id="csAgentCostDetail"></tbody>
                    <tfoot>
                        <tr><td><strong>총계 (VAT별도)</strong></td><td></td><td></td><td class="num" id="csAgentTotal" style="font-size:16px;">-</td></tr>
                    </tfoot>
                </table>

                <div class="result-box" style="margin-top:16px;">
                    <div class="result-title">최종 제안가</div>
                    <div style="display:flex;gap:16px;align-items:center;">
                        <input type="text" inputmode="numeric" data-money id="csAgentFinalPrice" value="0" style="width:180px;font-size:18px;font-weight:700;text-align:right;" onchange="state._csAgentManual = true; autoSave();">
                        <span style="font-size:14px;color:#4a5568;">원 (VAT별도)</span>
                    </div>
                    <div class="result-sub" id="csAgentDiscount"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">기타사항 (견적서에 표시)</div>
                <textarea id="csAgentNotes" rows="8" oninput="autoSave();" style="width:100%;font-size:13px;line-height:1.8;"></textarea>
                <div style="margin-top:8px;font-size:11px;color:#a0aec0;">한 줄에 하나씩 입력. 견적서 기타사항에 번호가 자동 부여됩니다.</div>
            </div>
        </div>

        <!-- ===== CS쉐어링 전용: 콜 조건 ===== -->
        <div class="for-cs-share">
            <div class="card">
                <div class="card-title">CS쉐어링 조건</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">월 기본 콜수 (건)</label>
                        <input type="number" id="shareBaseCall" value="500" step="50" onchange="calcCSShare(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">월 기본료 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="shareBaseFee" value="500,000" onchange="calcCSShare(); autoSave();">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">초과 건당 단가 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="sharePerCall" value="1,000" onchange="calcCSShare(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">통신비용</label>
                        <select id="shareComm" onchange="autoSave();">
                            <option value="실비청구">아웃콜 실비 청구</option>
                            <option value="포함">기본료에 포함</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">운영시간</label>
                        <input type="text" id="shareOpTime" value="평일 09:00~18:00" oninput="autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">초기 구축비 (원)</label>
                        <input type="text" inputmode="numeric" data-money id="shareSetupFee" value="0" onchange="autoSave();">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">CS 쉐어 월 콜 기준</label>
                    <input type="text" id="shareCallStandard" value="" placeholder="예: 월 500건 기준" oninput="autoSave();">
                </div>

                <div class="form-group">
                    <label class="form-label">업무범위</label>
                    <textarea id="shareWorkScope" rows="3" placeholder="예: 인바운드 CS 응대, 주문/교환/반품 안내" oninput="autoSave();"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">포함 서비스</label>
                    <textarea id="shareServices" rows="2" placeholder="예: 녹취 및 시스템 이용료 포함, DB 제공 (주간/월간 보고서)" oninput="autoSave();">녹취 및 시스템 이용료 포함, DB 제공 (주간/월간 보고서)</textarea>
                </div>
            </div>

            <div class="card">
                <div class="card-title">CS쉐어링 비용 산출</div>
                <table class="data-table">
                    <thead><tr><th>항목</th><th style="text-align:right;">단가</th><th style="text-align:right;">금액</th><th>비고</th></tr></thead>
                    <tbody id="csShareCostDetail"></tbody>
                    <tfoot>
                        <tr><td><strong>합계 (VAT별도)</strong></td><td></td><td class="num" id="csShareTotal" style="font-size:16px;">-</td><td></td></tr>
                    </tfoot>
                </table>

                <div class="result-box" style="margin-top:16px;">
                    <div class="result-title">최종 제안가</div>
                    <div style="display:flex;gap:16px;align-items:center;">
                        <input type="text" inputmode="numeric" data-money id="csShareFinalPrice" value="0" style="width:180px;font-size:18px;font-weight:700;text-align:right;" onchange="state._csShareManual = true; autoSave();">
                        <span style="font-size:14px;color:#4a5568;">원/월 (VAT별도)</span>
                    </div>
                    <div class="result-sub" id="csShareDiscount"></div>
                </div>

                <div class="card" style="margin-top:16px;">
                    <div class="card-title">기타사항 (견적서에 표시)</div>
                    <textarea id="csShareNotes" rows="8" oninput="autoSave();" style="width:100%;font-size:13px;line-height:1.8;"></textarea>
                    <div style="margin-top:8px;font-size:11px;color:#a0aec0;">한 줄에 하나씩 입력. 견적서 기타사항에 번호가 자동 부여됩니다.</div>
                </div>
            </div>
        </div>

        <!-- ===== 채용대행 전용: 직무별 인건비 ===== -->
        <div class="for-recruit">
            <div class="card">
                <div class="card-title">채용대행 조건</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">운영시간</label>
                        <input type="text" id="recruitOpTime" value="09:00~18:00" oninput="autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">인력 근무조건</label>
                        <input type="text" id="recruitWorkCond" value="주5일 / 일 8시간 근무" oninput="autoSave();">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">업무범위</label>
                    <textarea id="recruitWorkScope" rows="2" oninput="autoSave();">채용대행(구인 및 지원자 이력서 전달)</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">소개수수료율 (%)</label>
                    <input type="number" id="recruitFeeRate" value="8" step="1" min="1" max="30" onchange="calcRecruit(); autoSave();">
                </div>

                <div class="form-group">
                    <label class="form-label">최소 수수료 청구기간 (개월)</label>
                    <input type="number" id="recruitMinMonth" value="3" step="1" min="1" max="12" onchange="autoSave();">
                </div>
            </div>

            <div class="card">
                <div class="card-title">직무별 인건비 <button class="rate-toggle" onclick="addRecruitRow()">+ 직무 추가</button></div>

                <table class="data-table" id="recruitTable">
                    <thead>
                        <tr>
                            <th>직무명</th>
                            <th style="text-align:center;">경력구분</th>
                            <th style="text-align:right;">월 급여 (원)</th>
                            <th style="text-align:right;">인원</th>
                            <th style="text-align:right;">합계</th>
                            <th style="width:40px;"></th>
                        </tr>
                    </thead>
                    <tbody id="recruitRows">
                        <tr>
                            <td><input type="text" value="대리점관리파트" style="width:100%;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td style="text-align:center;"><select style="padding:4px;" onchange="calcRecruit(); autoSave();"><option>신입</option><option>경력</option></select></td>
                            <td><input type="text" inputmode="numeric" data-money value="2,500,000" style="width:100%;text-align:right;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td><input type="number" value="1" min="1" max="50" style="width:60px;text-align:center;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td class="num" style="font-weight:600;">-</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><input type="text" value="통화품질 담당" style="width:100%;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td style="text-align:center;"><select style="padding:4px;" onchange="calcRecruit(); autoSave();"><option>신입</option><option selected>경력</option></select></td>
                            <td><input type="text" inputmode="numeric" data-money value="2,670,000" style="width:100%;text-align:right;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td><input type="number" value="1" min="1" max="50" style="width:60px;text-align:center;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
                            <td class="num" style="font-weight:600;">-</td>
                            <td><button onclick="removeRecruitRow(this)" style="background:none;border:none;color:#e53e3e;cursor:pointer;font-size:16px;">&times;</button></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3"><strong>① 인건비 소계</strong></td>
                            <td class="num" id="recruitTotalPeople">-</td>
                            <td class="num" id="recruitLaborTotal" style="font-size:15px;">-</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan="4"><strong>② 소개수수료 (<span id="recruitFeeRateDisplay">8</span>%)</strong></td>
                            <td class="num" id="recruitFeeTotal">-</td>
                            <td></td>
                        </tr>
                        <tr style="background:#f0f5ff;">
                            <td colspan="4"><strong>합계 (①+②) (VAT 별도)</strong></td>
                            <td class="num" id="recruitGrandTotal" style="font-size:16px;font-weight:700;color:#1a365d;">-</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>

                <div class="result-box" style="margin-top:16px;">
                    <div class="result-title">최종 제안가</div>
                    <div style="display:flex;gap:16px;align-items:center;">
                        <input type="text" inputmode="numeric" data-money id="recruitFinalPrice" value="0" style="width:180px;font-size:18px;font-weight:700;text-align:right;" onchange="state._recruitManual = true; autoSave();">
                        <span style="font-size:14px;color:#4a5568;">원/월 (VAT별도)</span>
                    </div>
                    <div class="result-sub" id="recruitDiscount"></div>
                </div>
            </div>
        </div>

        <!-- ===== 도급 공통 (정액제/일반): 현장조건 ===== -->
        <div class="for-dogup">
        <div class="card">
            <div class="card-title">현장 조건 입력</div>

            <div class="form-group">
                <label class="form-label">근무 패턴</label>
                <div class="option-group">
                    <button class="option-btn" onclick="applyShiftPreset('day1', this)">주간(1교대)</button>
                    <button class="option-btn selected" onclick="applyShiftPreset('service', this)">서비스업</button>
                    <button class="option-btn" onclick="applyShiftPreset('mfg2', this)">제조 주야2교대</button>
                    <button class="option-btn" onclick="applyShiftPreset('mfg12', this)">제조 12시간</button>
                    <button class="option-btn" onclick="applyShiftPreset('mfg3', this)">3교대</button>
                    <button class="option-btn" onclick="applyShiftPreset('custom', this)">커스텀</button>
                </div>
                <div id="presetDesc" style="font-size:11px; color:#a0aec0; margin-top:6px;">영업시간을 교대로 나누어 커버</div>
            </div>

            <div class="form-group">
                <label class="form-label">교대수</label>
                <div class="option-group" id="shiftCountGroup">
                    <button class="option-btn" onclick="setShiftCount(1, this)">1교대</button>
                    <button class="option-btn selected" onclick="setShiftCount(2, this)">2교대</button>
                    <button class="option-btn" onclick="setShiftCount(3, this)">3교대</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">교대조 시간표</label>
                <table class="data-table" style="margin:0;">
                    <thead>
                        <tr>
                            <th style="width:70px;">교대조</th>
                            <th>시작</th>
                            <th>종료</th>
                            <th>잔업종료 <span style="font-weight:400;color:#a0aec0;">(선택)</span></th>
                            <th style="width:80px;text-align:right;">시간</th>
                        </tr>
                    </thead>
                    <tbody id="shiftTableBody">
                        <tr>
                            <td style="font-weight:600;color:#1a365d;">1교대</td>
                            <td><input type="text" id="s1Start" value="08:00" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s1End" value="15:30" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s1OT" value="" placeholder="-" style="width:70px;text-align:center;padding:4px;color:#ed8936;" onchange="calcPersonnel(); autoSave();"></td>
                            <td class="num" id="s1Hours">7.5h</td>
                        </tr>
                        <tr id="shift2Row">
                            <td style="font-weight:600;color:#1a365d;">2교대</td>
                            <td><input type="text" id="s2Start" value="15:30" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s2End" value="23:00" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s2OT" value="" placeholder="-" style="width:70px;text-align:center;padding:4px;color:#ed8936;" onchange="calcPersonnel(); autoSave();"></td>
                            <td class="num" id="s2Hours">7.5h</td>
                        </tr>
                        <tr id="shift3Row" style="display:none;">
                            <td style="font-weight:600;color:#1a365d;">3교대</td>
                            <td><input type="text" id="s3Start" value="" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s3End" value="" style="width:70px;text-align:center;padding:4px;" onchange="calcPersonnel(); autoSave();"></td>
                            <td><input type="text" id="s3OT" value="" placeholder="-" style="width:70px;text-align:center;padding:4px;color:#ed8936;" onchange="calcPersonnel(); autoSave();"></td>
                            <td class="num" id="s3Hours">-</td>
                        </tr>
                    </tbody>
                </table>
                <div style="font-size:11px; color:#a0aec0; margin-top:4px;">시간은 HH:MM 형식. 야간(익일) = 24시 이후로 입력 (예: 05:00 → 29:00)</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">주간 운영일</label>
                    <div class="option-group">
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주1일</button>
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주2일</button>
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주3일</button>
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주4일</button>
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주5일</button>
                        <button class="option-btn" onclick="selectOption(this,'opDays'); autoSave();">주6일</button>
                        <button class="option-btn selected" onclick="selectOption(this,'opDays'); autoSave();">주7일</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">교대당 필요 인원</label>
                    <input type="number" id="perShift" value="4" min="1" max="50" onchange="calcPersonnel(); autoSave();">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">현장관리자 <span class="hint">(별도)</span></label>
                <div class="option-group">
                    <button class="option-btn selected" onclick="selectOption(this,'manager'); autoSave();">1명 배치</button>
                    <button class="option-btn" onclick="selectOption(this,'manager'); autoSave();">미배치</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">인원 산출 결과</div>

            <div class="result-box">
                <div class="result-title">산출 인원 (내부용 — 견적서에 절대 노출 금지)</div>
                <div style="display:flex; gap: 30px; align-items:flex-end;">
                    <div>
                        <div class="result-value" id="totalPersonnel">12명</div>
                        <div class="result-sub" id="personnelFormula">4명 × 2교대 × 7일 ÷ 5일 = 11.2 → 12명</div>
                    </div>
                    <div id="managerInfo" style="font-size:13px; color:#4a5568;">
                        + 현장관리자 1명
                    </div>
                </div>
                <div id="personnelOverrideBox" style="display:none; margin-top:14px; padding-top:14px; border-top:1px dashed #e2e8f0;">
                    <div style="display:flex; align-items:center; gap:12px;">
                        <label style="font-size:12px; font-weight:600; color:#c53030;">실제 투입 인원 직접 입력:</label>
                        <input type="number" id="personnelOverride" value="" min="1" max="100" style="width:70px; text-align:center; font-size:16px; font-weight:700; padding:6px; border:2px solid #c53030; border-radius:6px;" onchange="applyPersonnelOverride(); autoSave();">
                        <span style="font-size:12px; color:#888;">명</span>
                        <button onclick="clearPersonnelOverride()" style="font-size:11px; color:#888; background:none; border:1px solid #ccc; border-radius:4px; padding:3px 8px; cursor:pointer;">자동계산 복원</button>
                    </div>
                    <div style="font-size:11px; color:#a0aec0; margin-top:4px;">소규모 현장: 1명이 주6~7일 근무 시 추가일은 연장수당으로 처리</div>
                </div>
            </div>

            <table class="data-table" style="margin-top:16px;">
                <thead>
                    <tr><th>항목</th><th style="text-align:right;">수치</th></tr>
                </thead>
                <tbody id="personnelDetail">
                </tbody>
            </table>

            <div class="alert alert-warning" style="margin-top:16px;">
                <span>&#9888;</span>
                <span>이 인원수는 내부 원가계산용입니다. 견적서·고객 대화에서 절대 언급하지 마세요.</span>
            </div>
        </div>

        </div><!-- /for-dogup -->

        <!-- 일반도급 전용: 관리수수료 설정 -->
        <div class="for-labor">
            <div class="card">
                <div class="card-title">일반 도급 추가 설정</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">관리수수료 (%)</label>
                        <input type="number" id="laborMgmtFee" value="8" step="1" min="0" max="30" onchange="calcCost(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">교통비 (인당/월)</label>
                        <input type="text" inputmode="numeric" data-money id="laborTransport" value="100,000" onchange="calcCost(); autoSave();">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">직책수당 (현장관리자)</label>
                        <input type="text" inputmode="numeric" data-money id="laborLeaderPay" value="100,000" onchange="calcCost(); autoSave();">
                    </div>
                    <div class="form-group">
                        <label class="form-label">사업소세 (%)</label>
                        <input type="number" id="laborBizTax" value="0.5" step="0.1" min="0" onchange="calcCost(); autoSave();">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">장기요양보험 (건강보험료 대비 %)</label>
                    <input type="number" id="laborLongCare" value="13.14" step="0.01" min="0" onchange="calcCost(); autoSave();">
                </div>
            </div>
        </div>

        <div class="btn-group" style="justify-content:space-between;">
            <button class="btn btn-secondary" onclick="switchTab(0)">&larr; 고객정보</button>
            <button class="btn btn-primary" onclick="switchTab(2)">다음: 원가계산 &rarr;</button>
        </div>
    </div>

    <!-- ==================== 탭3: 원가계산 ==================== -->
    <div class="tab-content" id="tab2">

        <!-- CS대행/쉐어링/채용대행은 Tab2에서 비용 산출까지 완료 → Tab3은 건너뜀 안내 -->
        <div class="for-cs">
            <div class="card">
                <div class="alert alert-info">
                    <span>&#128161;</span>
                    <span>CS 견적은 이전 탭에서 비용 산출이 완료되었습니다. <strong>견적서생성</strong>으로 이동하세요.</span>
                </div>
                <div class="btn-group" style="justify-content:center;">
                    <button class="btn btn-primary" onclick="switchTab(4)">견적서 생성으로 이동 &rarr;</button>
                </div>
            </div>
        </div>
        <div class="for-recruit">
            <div class="card">
                <div class="alert alert-info">
                    <span>&#128161;</span>
                    <span>채용대행 견적은 이전 탭에서 비용 산출이 완료되었습니다. <strong>견적서생성</strong>으로 이동하세요.</span>
                </div>
                <div class="btn-group" style="justify-content:center;">
                    <button class="btn btn-primary" onclick="switchTab(4)">견적서 생성으로 이동 &rarr;</button>
                </div>
            </div>
        </div>

        <div class="for-dogup">
        <div class="card">
            <div class="card-title">인건비 계산</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">시급 (원)</label>
                    <input type="text" inputmode="numeric" data-money id="hourlyWage" value="10,500" onchange="calcCost(); autoSave();">
                    <div style="font-size:11px; color:#a0aec0; margin-top:4px;">2026년 최저시급: 10,320원</div>
                </div>
                <div class="form-group">
                    <label class="form-label">기본급 (자동계산)</label>
                    <div class="result-box" style="padding:10px 14px;">
                        <span id="baseWage" style="font-size:18px; font-weight:600;">2,194,500원</span>
                        <div class="result-sub">시급 × 209시간</div>
                    </div>
                </div>
            </div>

            <div style="margin-top:8px;">
                <span style="font-size:13px; font-weight:600; color:#4a5568;">요율 설정</span>
                <button class="rate-toggle" onclick="toggleRates()">수정하기</button>
                <div class="rate-settings" id="rateSettings">
                    <div style="font-size:11px; color:#a0aec0; margin-bottom:8px;">업종/연도에 따라 요율이 다릅니다. 필요 시 수정하세요.</div>
                    <div class="rate-row">
                        <div class="rate-item">
                            <span>국민연금</span>
                            <input type="number" id="ratePension" value="4.5" step="0.1" onchange="calcCost(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>건강보험</span>
                            <input type="number" id="rateHealth" value="3.545" step="0.001" onchange="calcCost(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>고용보험</span>
                            <input type="number" id="rateEmploy" value="0.9" step="0.1" onchange="calcCost(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>산재보험</span>
                            <input type="number" id="rateIndust" value="1.5" step="0.1" onchange="calcCost(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>퇴직금</span>
                            <input type="number" id="rateRetire" value="8.33" step="0.01" onchange="calcCost(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>심야가산</span>
                            <input type="number" id="rateNight" value="50" step="5" onchange="calcPersonnel(); autoSave();">
                            <span>%</span>
                        </div>
                        <div class="rate-item">
                            <span>야간시작</span>
                            <input type="number" id="nightStart" value="22" step="1" min="18" max="24" onchange="calcPersonnel(); autoSave();">
                            <span>시</span>
                        </div>
                        <div class="rate-item">
                            <span>야간종료</span>
                            <input type="number" id="nightEnd" value="6" step="1" min="0" max="8" onchange="calcPersonnel(); autoSave();">
                            <span>시</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">원가 산출 상세</div>

            <table class="data-table">
                <thead>
                    <tr><th>항목</th><th style="text-align:right;">금액</th><th style="text-align:right;">비고</th></tr>
                </thead>
                <tbody id="costDetail">
                </tbody>
                <tfoot>
                    <tr>
                        <td><strong>총 원가</strong></td>
                        <td class="num" id="totalCost" style="font-size:16px;">-</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="card">
            <div class="card-title">기타 비용 조정</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">야간수당 (월, 원) <span class="hint">22시 이후 근무 시</span></label>
                    <input type="text" inputmode="numeric" data-money id="nightPay" value="0" onchange="calcCost(); autoSave();">
                </div>
                <div class="form-group">
                    <label class="form-label">기타비용 (월, 원) <span class="hint">유니폼/교육/채용 등</span></label>
                    <input type="text" inputmode="numeric" data-money id="etcCost" value="1,000,000" onchange="calcCost(); autoSave();">
                </div>
            </div>
        </div>

        </div><!-- /for-dogup -->

        <div class="btn-group" style="justify-content:space-between;">
            <button class="btn btn-secondary" onclick="switchTab(1)">&larr; 인원산출</button>
            <button class="btn btn-primary" onclick="switchTab(3)">다음: 견적시뮬 &rarr;</button>
        </div>
    </div>

    <!-- ==================== 탭4: 견적시뮬레이션 ==================== -->
    <div class="tab-content" id="tab3">
        <div class="card">
            <div class="card-title">견적 금액 시뮬레이션</div>

            <div class="result-box" style="margin-bottom:20px;">
                <div class="result-title">총 원가 (기준)</div>
                <div class="result-value" id="simBaseCost">-</div>
            </div>

            <div class="scenario-cards">
                <div class="scenario-card primary">
                    <div class="scenario-label">첫 제시</div>
                    <div style="margin-bottom:8px;">
                        <input type="number" class="scenario-input" id="simQuote1" value="4500" onchange="updateScenarios(true); autoSave();"> 만원
                    </div>
                    <div class="scenario-detail">이익: <strong id="simProfit1">-</strong></div>
                    <div class="scenario-detail">마진: <strong id="simMargin1">-</strong></div>
                </div>
                <div class="scenario-card secondary">
                    <div class="scenario-label">1차 양보</div>
                    <div style="margin-bottom:8px;">
                        <input type="number" class="scenario-input" id="simQuote2" value="4300" onchange="updateScenarios(true); autoSave();"> 만원
                    </div>
                    <div class="scenario-detail">이익: <strong id="simProfit2">-</strong></div>
                    <div class="scenario-detail">마진: <strong id="simMargin2">-</strong></div>
                </div>
                <div class="scenario-card danger">
                    <div class="scenario-label">마지노선</div>
                    <div style="margin-bottom:8px;">
                        <input type="number" class="scenario-input" id="simQuote3" value="4000" onchange="updateScenarios(true); autoSave();"> 만원
                    </div>
                    <div class="scenario-detail">이익: <strong id="simProfit3">-</strong></div>
                    <div class="scenario-detail">마진: <strong id="simMargin3">-</strong></div>
                </div>
            </div>
        </div>

        <div class="card for-outsource">
            <div class="card-title">항목 분배 (첫 제시 기준) — 정액제</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">도급운영비 (만원)</label>
                    <input type="number" id="itemDogup" value="4000" step="100" onchange="updateItemTotal(); autoSave();">
                </div>
                <div class="form-group">
                    <label class="form-label">현장관리비 (만원)</label>
                    <input type="number" id="itemManage" value="300" step="50" onchange="updateItemTotal(); autoSave();">
                </div>
                <div class="form-group">
                    <label class="form-label">관리운영비 (만원)</label>
                    <input type="number" id="itemAdmin" value="200" step="50" onchange="updateItemTotal(); autoSave();">
                </div>
            </div>

            <div class="result-box" id="itemTotalBox">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div class="result-title">항목 합계</div>
                        <div id="itemTotal" style="font-size:20px; font-weight:700;">4,500만원</div>
                    </div>
                    <div id="itemMismatch" style="display:none; color:#e53e3e; font-size:13px; font-weight:600;">
                        &#9888; 첫 제시 금액과 불일치
                    </div>
                </div>
            </div>

            <div class="alert alert-info" style="margin-top:12px;">
                <span>&#128161;</span>
                <span><strong>팁:</strong> 협상 시 관리비(현장관리비+관리운영비)는 지키고 도급운영비에서 조정하세요.</span>
            </div>
        </div>

        <div class="btn-group" style="justify-content:space-between;">
            <button class="btn btn-secondary" onclick="switchTab(2)">&larr; 원가계산</button>
            <button class="btn btn-primary" onclick="switchTab(4)">다음: 견적서 생성 &rarr;</button>
        </div>
    </div>

    <!-- ==================== 탭5: 견적서 생성 ==================== -->
    <div class="tab-content" id="tab4">
        <div class="card">
            <div class="card-title">견적서 정보</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">견적번호 <span class="hint">(비우면 자동생성)</span></label>
                    <input type="text" id="quoteNumber" placeholder="예: WWC-20260223-001" oninput="autoSave()">
                </div>
                <div class="form-group">
                    <label class="form-label">견적일자 <span class="hint">(비우면 오늘날짜)</span></label>
                    <input type="text" id="quoteDate" placeholder="예: 2026년 02월 23일" oninput="autoSave()">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">업무 범위 <span class="hint">(한 줄씩 입력)</span></label>
                <textarea id="workScope" rows="4" placeholder="예:&#10;드라잉존 물기 제거 작업&#10;입차 유도 및 고객 차량 안내&#10;고객 응대 및 안내 서비스" oninput="autoSave()"></textarea>
            </div>

            <div class="form-group for-outsource">
                <label class="form-label">기타사항 (견적서에 표시) <span class="hint">한 줄에 하나씩</span></label>
                <textarea id="outsourceNotes" rows="6" oninput="autoSave();" style="font-size:13px;line-height:1.8;"></textarea>
            </div>
            <div class="form-group for-labor">
                <label class="form-label">기타사항 (견적서에 표시) <span class="hint">한 줄에 하나씩</span></label>
                <textarea id="laborNotes" rows="7" oninput="autoSave();" style="font-size:13px;line-height:1.8;"></textarea>
            </div>
            <div class="form-group for-dispatch">
                <label class="form-label">기타사항 (견적서에 표시) <span class="hint">한 줄에 하나씩</span></label>
                <textarea id="dispatchNotes" rows="7" oninput="autoSave();" style="font-size:13px;line-height:1.8;"></textarea>
            </div>
            <div class="form-group for-recruit">
                <label class="form-label">기타사항 (견적서에 표시) <span class="hint">한 줄에 하나씩</span></label>
                <textarea id="recruitNotes" rows="6" oninput="autoSave();" style="font-size:13px;line-height:1.8;"></textarea>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-success" onclick="generateQuote()">견적서 생성 및 미리보기</button>
            <button class="btn btn-primary" onclick="printQuote()">PDF 인쇄 (Ctrl+P)</button>
        </div>

        <div id="quotePreview" style="margin-top:20px;"></div>

        <div class="btn-group" style="justify-content:space-between; margin-top:20px;">
            <button class="btn btn-secondary" onclick="switchTab(3)">&larr; 견적시뮬</button>
            <button class="btn btn-primary" onclick="switchTab(5)">다음: 체크리스트 &rarr;</button>
        </div>
    </div>

    <!-- ==================== 탭6: 체크리스트 ==================== -->
    <div class="tab-content" id="tab5">
        <div class="card">
            <div class="card-title">견적 워크플로우 체크리스트</div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
            <div style="text-align:right; font-size:12px; color:#718096; margin-bottom:16px;" id="progressText">0 / 10 완료</div>

            <ul class="checklist" id="checklist">
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">1단계</span><span class="check-text">고객 사전조사 완료</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">2단계</span><span class="check-text">현장 정보 파악 완료</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">3단계</span><span class="check-text">인원 산출 완료 (내부용)</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">4단계</span><span class="check-text">원가 계산 완료</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">5단계</span><span class="check-text">견적 금액 결정 (마진 확인)</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">6단계</span><span class="check-text">견적서 작성 & PDF 변환</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">7단계</span><span class="check-text">메일 발송 완료</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">8단계</span><span class="check-text">팔로업 (읽음 확인 → 전화)</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">9단계</span><span class="check-text">협상 대응 완료</span></div>
                </li>
                <li onclick="toggleCheck(this)">
                    <div class="check-box"></div>
                    <div><span class="check-step">10단계</span><span class="check-text">계약 체결 → 현장 투입</span></div>
                </li>
            </ul>
        </div>

        <div class="card">
            <div class="card-title">결과 기록</div>
            <div class="form-group">
                <label class="form-label">최종 결과</label>
                <div class="option-group">
                    <button class="option-btn" onclick="selectOption(this,'result'); autoSave();" style="border-color:#38a169; color:#38a169;">Win (계약성사)</button>
                    <button class="option-btn" onclick="selectOption(this,'result'); autoSave();" style="border-color:#e53e3e; color:#e53e3e;">Loss (미성사)</button>
                    <button class="option-btn" onclick="selectOption(this,'result'); autoSave();" style="border-color:#ed8936; color:#ed8936;">Pending (진행중)</button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">최종 계약가 (만원)</label>
                <input type="text" inputmode="numeric" data-money id="finalPrice" oninput="autoSave()">
            </div>
            <div class="form-group">
                <label class="form-label">교훈 / 메모</label>
                <textarea id="lessonMemo" rows="3" placeholder="이번 건에서 배운 점..." oninput="autoSave()"></textarea>
            </div>
        </div>

        <div class="btn-group" style="justify-content:flex-start;">
            <button class="btn btn-secondary" onclick="switchTab(4)">&larr; 견적서생성</button>
        </div>
    </div>

</div>

<!-- ===== 이력 모달 ===== -->
<div class="modal-overlay" id="historyModal" onclick="if(event.target===this)closeHistory()">
    <div class="modal">
        <div class="modal-header">
            <h2>견적 이력</h2>
            <button class="modal-close" onclick="closeHistory()">&times;</button>
        </div>
        <div class="modal-body" id="historyList"></div>
        <div class="modal-footer">
            <span style="font-size:11px;color:#a0aec0;">최대 50건 저장 | 브라우저 localStorage 기반</span>
        </div>
    </div>
</div>

<!-- ===== 구글시트 설정 모달 ===== -->
<div class="modal-overlay" id="sheetModal" onclick="if(event.target===this)closeSheetModal()">
    <div class="modal" style="max-width:560px;">
        <div class="modal-header">
            <h2>구글시트 연동 설정</h2>
            <button class="modal-close" onclick="closeSheetModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="alert alert-info" style="margin-bottom:16px;">
                아래 Apps Script 웹앱 URL을 입력하면, 견적 데이터가 구글시트에 자동으로 추가됩니다.
            </div>

            <div class="form-group">
                <label class="form-label">Apps Script 웹앱 URL</label>
                <input type="text" id="sheetWebAppUrl" placeholder="https://script.google.com/macros/s/...../exec" oninput="saveSheetSettings()">
            </div>

            <div style="margin-top:20px; padding:16px; background:#f7fafc; border-radius:8px; border:1px solid #e2e8f0;">
                <div style="font-size:13px; font-weight:600; color:#1a365d; margin-bottom:12px;">설정 방법 (최초 1회)</div>
                <ol style="font-size:12px; color:#4a5568; padding-left:20px; line-height:2;">
                    <li>구글시트를 새로 만들기</li>
                    <li>메뉴 → <strong>확장 프로그램</strong> → <strong>Apps Script</strong></li>
                    <li>아래 코드를 복사해서 붙여넣기</li>
                    <li><strong>배포</strong> → <strong>새 배포</strong> → 유형: <strong>웹 앱</strong></li>
                    <li>액세스 권한: <strong>모든 사용자</strong> → 배포</li>
                    <li>생성된 URL을 위 입력란에 붙여넣기</li>
                </ol>
                <button class="btn btn-secondary" onclick="copyAppsScript()" style="margin-top:12px;font-size:12px;padding:8px 16px;">
                    Apps Script 코드 복사
                </button>
                <span id="scriptCopyMsg" style="font-size:11px;color:#38a169;margin-left:8px;display:none;">복사됨!</span>
            </div>

            <div id="sheetTestResult" style="margin-top:12px;font-size:12px;display:none;"></div>
        </div>
        <div class="modal-footer" style="display:flex;justify-content:space-between;align-items:center;">
            <button class="btn btn-secondary" onclick="testSheetConnection()" style="font-size:12px;">연결 테스트</button>
            <button class="btn btn-primary" onclick="closeSheetModal()" style="font-size:12px;">확인</button>
        </div>
    </div>
</div>

<script>
// ===== 전역 상태 =====
let state = {
    quoteType: 'outsource',
    source: '', currentOps: '', opDays: '주7일', shifts: '2교대',
    manager: '1명 배치', result: '',
    checklist: [false,false,false,false,false,false,false,false,false,false]
};

// ===== 금액 포맷 유틸리티 =====
function numVal(id) {
    return parseInt(String(document.getElementById(id)?.value || '0').replace(/,/g, '')) || 0;
}
function numElVal(el) {
    return parseInt(String(el?.value || '0').replace(/,/g, '')) || 0;
}
function fmtMoneyInput(el) {
    try {
        const pos = el.selectionStart || 0;
        const oldLen = el.value.length;
        const v = el.value.replace(/[^0-9]/g, '');
        if (v === '') { el.value = ''; return; }
        el.value = parseInt(v).toLocaleString('ko-KR');
        const diff = el.value.length - oldLen;
        const np = Math.max(0, pos + diff);
        try { el.setSelectionRange(np, np); } catch(e2) {}
    } catch(e) { console.warn('fmtMoneyInput error:', e); }
}
function fmtAllMoney() {
    document.querySelectorAll('[data-money]').forEach(el => {
        if (el.value && el.value !== '0' && el.value !== '') fmtMoneyInput(el);
    });
}
document.addEventListener('input', function(e) {
    if (e.target.hasAttribute('data-money')) fmtMoneyInput(e.target);
});

// ===== 탭 전환 =====
function switchTab(idx) {
    document.querySelectorAll('.tab-content').forEach((el,i) => {
        el.classList.toggle('active', i === idx);
    });
    document.querySelectorAll('.tab-btn').forEach((el,i) => {
        el.classList.toggle('active', i === idx);
    });

    // 탭 전환 시 자동 계산
    if (idx === 1) calcPersonnel();
    if (idx === 2) calcCost();
    if (idx === 3) { updateScenarios(); updateItemTotal(); }
}

// ===== 옵션 버튼 선택 =====
function selectOption(btn, group) {
    btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    state[group] = btn.textContent.trim();

    if (group === 'opDays' || group === 'shifts' || group === 'manager') {
        calcPersonnel();
    }
    autoSave();
}

// ===== 견적 유형 전환 =====
function switchQuoteType(type, card) {
    // 버튼 표시
    document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
    if (card) card.classList.add('selected');

    state.quoteType = type;

    // body 클래스로 유형별 표시 제어
    document.body.className = 'qt-' + type;

    // 탭 라벨 변경
    const tabLabels = {
        outsource: ['고객정보','인원산출','원가계산','견적시뮬','견적서생성','체크리스트'],
        labor:     ['고객정보','인원산출','원가계산','견적시뮬','견적서생성','체크리스트'],
        dispatch:  ['고객정보','인원산출','원가계산','견적시뮬','견적서생성','체크리스트'],
        'cs-agent':['고객정보','상담사구성','(건너뜀)','(건너뜀)','견적서생성','체크리스트'],
        'cs-share':['고객정보','콜조건','(건너뜀)','(건너뜀)','견적서생성','체크리스트'],
        recruit:   ['고객정보','직무구성','(건너뜀)','(건너뜀)','견적서생성','체크리스트']
    };
    const labels = tabLabels[type] || tabLabels.outsource;
    document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        const numEl = btn.querySelector('.tab-num');
        const text = btn.childNodes[btn.childNodes.length - 1];
        if (text && text.nodeType === 3) text.textContent = labels[i];
    });

    // CS대행 기타사항 기본값 세팅 (비어있을 때만)
    const csNotesEl = document.getElementById('csAgentNotes');
    if (type === 'cs-agent' && csNotesEl && !csNotesEl.value.trim()) {
        const setupFee = numVal('csSetupFee') || 1000000;
        csNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무내용 및 근로자 수에 따라 상이할 수 있음.',
            '연도별로 단가 상이할 수 있음.',
            '교육비 별도 청구.',
            '야간, 휴일, 연장 근무 발생 시 별도 수당 청구.',
            'ASP 패키지 : 시설 및 좌석 배치, 보안, 관리 수수료 등 포함.',
            '초기 구축비 ' + fmt(setupFee) + '원 별도 청구. → 한시적 면제 프로모션 적용',
            '최소 12개월 이상 계약 체결 필수. → 한시적 협의 가능',
            '부가세 별도 청구함.'
        ].join('\n');
    }

    // CS쉐어링 기타사항 기본값 세팅 (비어있을 때만)
    const csShareNotesEl = document.getElementById('csShareNotes');
    if (type === 'cs-share' && csShareNotesEl && !csShareNotesEl.value.trim()) {
        const shareSetup = numVal('shareSetupFee');
        const shareOpTimeVal = document.getElementById('shareOpTime').value || '평일 09:00~18:00';
        csShareNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무 내용과 발생 건수에 따라 조정될 수 있음.',
            '녹취 및 시스템 이용료 포함 및 DB 제공. 녹취서비스는 60일 보관기준이며 DB 제공은 주간, 월간 보고서 형태로 제출.',
            '근무요일 및 시간: ' + shareOpTimeVal,
            '발신 비용은 별도로 실비 청구함(아웃콜).',
            shareSetup > 0 ? '초기 구축 비용 ' + fmt(shareSetup) + '원 별도 청구 (1회성).' : '초기 구축 비용 면제 (프로모션 적용).',
            '최소 12개월 이상 계약 체결 필수.',
            '부가세 별도 청구함.',
            '주말(공휴일), 야간, 심야 시간대 단가 협의 필요.'
        ].join('\n');
    }

    // 정액제 도급 기타사항 기본값 세팅 (비어있을 때만)
    const outsourceNotesEl = document.getElementById('outsourceNotes');
    if (type === 'outsource' && outsourceNotesEl && !outsourceNotesEl.value.trim()) {
        outsourceNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무내용 및 근로자 수에 따라 상이할 수 있음.',
            '부가세 별도 청구함.',
            '야간수당(22시 이후) 및 공휴일 가산수당은 도급비에 포함되어 있음.',
            '운영 시간 또는 서비스 범위 변경 시 월 도급비는 협의를 통해 조정함.'
        ].join('\n');
    }

    // 일반 도급 기타사항 기본값 세팅 (비어있을 때만)
    const laborNotesEl = document.getElementById('laborNotes');
    if (type === 'labor' && laborNotesEl && !laborNotesEl.value.trim()) {
        laborNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무내용 및 근로자 수에 따라 상이할 수 있음.',
            '최저시급 및 4대보험은 당해연도 법정 기준을 반영함.',
            '근로기준법에 의거한 연장, 심야, 휴일근무 수당 및 퇴직금 등은 발생 시 별도 청구함.',
            '관리수수료 포함내역: 채용 광고비, 급여/4대보험 행정대행, 노무 자문 및 리스크 관리, 결원 대응비, 근로자 복리후생비 등 제세 간접비 포함',
            '부가세 별도 청구함.'
        ].join('\n');
    }

    // 파견 기타사항 기본값 세팅 (비어있을 때만)
    const dispatchNotesEl = document.getElementById('dispatchNotes');
    if (type === 'dispatch' && dispatchNotesEl && !dispatchNotesEl.value.trim()) {
        dispatchNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무내용 및 근로자 수에 따라 상이할 수 있음.',
            '최저시급 및 4대보험은 당해연도 법정 기준을 반영함.',
            '근로기준법에 의거한 연장, 심야, 휴일근무 수당 및 퇴직금 등은 발생 시 별도 청구함.',
            '파견수수료 포함내역: 채용 광고비, 급여/4대보험 행정대행, 노무 자문 및 리스크 관리, 결원 대응비, 근로자 복리후생비 등 제세 간접비 포함',
            '파견근로자보호법에 따른 사용기간 및 조건을 준수함.',
            '부가세 별도 청구함.'
        ].join('\n');
    }

    // 채용대행 기타사항 기본값 세팅 (비어있을 때만)
    const recruitNotesEl = document.getElementById('recruitNotes');
    if (type === 'recruit' && recruitNotesEl && !recruitNotesEl.value.trim()) {
        const feeRate = document.getElementById('recruitFeeRate').value || '10';
        const minMonth = document.getElementById('recruitMinMonth').value || '3';
        recruitNotesEl.value = [
            '위 내용은 예산(안)으로 실제 근무내용 및 근로자 수에 따라 상이할 수 있음.',
            '각 직무별 근로자 인건비의 ' + feeRate + '%를 채용대행 수수료로 책정함.',
            '채용대행 수수료 청구기간: 최소 ' + minMonth + '개월 (협의가능).',
            '부가세 별도 청구함.'
        ].join('\n');
    }

    // 운영방식 첫 번째 버튼: CS대행이면 '인하우스', 나머지는 '직접고용'
    const selfBtn = document.getElementById('btnCurrentOpsSelf');
    if (selfBtn) {
        const newLabel = (type === 'cs-agent') ? '인하우스' : '직접고용';
        // 선택된 상태의 값도 업데이트
        if (selfBtn.classList.contains('selected') && state.currentOps !== newLabel) {
            state.currentOps = newLabel;
        }
        selfBtn.textContent = newLabel;
    }

    autoSave();
}

// ===== CS대행 비용 계산 =====
function calcCSAgent() {
    const leaderN = parseFloat(document.getElementById('csLeaderCount').value) || 0;
    const leaderS = numVal('csLeaderSalary');
    const seniorN = parseFloat(document.getElementById('csSeniorCount').value) || 0;
    const seniorS = numVal('csSeniorSalary');
    const juniorN = parseFloat(document.getElementById('csJuniorCount').value) || 0;
    const juniorS = numVal('csJuniorSalary');
    const asp = numVal('csASP');
    const mgmtRaw = parseFloat(document.getElementById('csMgmtFee').value);
    const mgmtPct = isNaN(mgmtRaw) ? 8 : mgmtRaw;

    const totalPeople = leaderN + seniorN + juniorN;
    const laborCost = Math.round(leaderN * leaderS + seniorN * seniorS + juniorN * juniorS);
    const aspCost = Math.round(asp * totalPeople);
    const subtotal = laborCost + aspCost;
    const mgmtCost = Math.round(subtotal * mgmtPct / 100);
    const total = subtotal + mgmtCost;

    let html = '';
    if (leaderN > 0) html += '<tr><td>팀장</td><td class="num">' + fmt(leaderS) + '</td><td class="num">' + leaderN + '</td><td class="num">' + fmt(Math.round(leaderN * leaderS)) + '</td></tr>';
    if (seniorN > 0) html += '<tr><td>선임 상담사</td><td class="num">' + fmt(seniorS) + '</td><td class="num">' + seniorN + '</td><td class="num">' + fmt(Math.round(seniorN * seniorS)) + '</td></tr>';
    if (juniorN > 0) html += '<tr><td>일반 상담사</td><td class="num">' + fmt(juniorS) + '</td><td class="num">' + juniorN + '</td><td class="num">' + fmt(Math.round(juniorN * juniorS)) + '</td></tr>';
    html += '<tr style="background:#f7fafc;"><td><strong>직·간접 노무비 소계</strong></td><td></td><td class="num">' + totalPeople + '</td><td class="num highlight">' + fmt(laborCost) + '</td></tr>';
    html += '<tr><td>ASP 패키지</td><td class="num">' + fmt(asp) + '</td><td class="num">' + totalPeople + '</td><td class="num">' + fmt(aspCost) + '</td></tr>';
    html += '<tr><td>원 운영비 (발신비용)</td><td colspan="2" style="text-align:right;color:#718096;">실비 청구</td><td class="num">-</td></tr>';
    html += '<tr style="background:#f7fafc;"><td><strong>합계 (①+②)</strong></td><td></td><td></td><td class="num highlight">' + fmt(subtotal) + '</td></tr>';
    html += '<tr><td>관리수수료 (' + mgmtPct + '%)</td><td></td><td></td><td class="num">' + fmt(mgmtCost) + '</td></tr>';

    document.getElementById('csAgentCostDetail').innerHTML = html;
    document.getElementById('csAgentTotal').textContent = fmt(total) + '원';

    // 최종 제안가 자동 세팅 (처음만)
    const fp = document.getElementById('csAgentFinalPrice');
    if (!state._csAgentManual) {
        fp.value = Math.ceil(total / 100000) * 100000;
        fmtMoneyInput(fp);
    }

    const finalP = numElVal(fp);
    const diff = total - finalP;
    document.getElementById('csAgentDiscount').textContent =
        finalP < total ? '할인: ' + fmt(total - finalP) + '원 (' + ((total - finalP)/total*100).toFixed(1) + '%)' :
        finalP > total ? '마진: +' + fmt(finalP - total) + '원' : '원가 동일';

    state.csAgentTotal = total;
}

// ===== CS쉐어링 비용 계산 =====
function calcCSShare() {
    const baseFee = numVal('shareBaseFee');
    const baseCall = parseInt(document.getElementById('shareBaseCall').value) || 0;
    const perCall = numVal('sharePerCall');
    const comm = document.getElementById('shareComm').value;

    let html = '';
    html += '<tr><td>기본료</td><td class="num">' + fmt(baseFee) + '</td><td class="num">' + fmt(baseFee) + '</td><td>월 ' + baseCall + '건 기준</td></tr>';
    html += '<tr><td>콜 단가 (초과분)</td><td class="num">' + fmt(perCall) + '/건</td><td class="num">-</td><td>월 ' + baseCall + '건 초과 시</td></tr>';
    html += '<tr><td>통신 비용</td><td></td><td class="num">-</td><td>' + (comm === '실비청구' ? '아웃콜 실비 발생 시 청구' : '기본료 포함') + '</td></tr>';

    document.getElementById('csShareCostDetail').innerHTML = html;
    document.getElementById('csShareTotal').textContent = fmt(baseFee) + '원~';

    const fp = document.getElementById('csShareFinalPrice');
    if (!state._csShareManual) {
        fp.value = baseFee;
        fmtMoneyInput(fp);
    }

    state.csShareBaseFee = baseFee;
}

// ===== 채용대행 비용 계산 =====
function calcRecruit() {
    const rows = document.getElementById('recruitRows').querySelectorAll('tr');
    const feeRate = parseFloat(document.getElementById('recruitFeeRate').value) || 8;
    let totalPeople = 0;
    let totalLabor = 0;

    rows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        if (inputs.length < 3) return;
        const salary = numElVal(inputs[1]);
        const count = parseInt(inputs[2].value) || 0;
        const subtotal = salary * count;
        totalPeople += count;
        totalLabor += subtotal;
        // 합계 셀 업데이트
        const tds = row.querySelectorAll('td');
        tds[4].textContent = fmt(subtotal);
    });

    const fee = Math.round(totalLabor * feeRate / 100);
    const grandTotal = totalLabor + fee;

    document.getElementById('recruitTotalPeople').textContent = totalPeople;
    document.getElementById('recruitLaborTotal').textContent = fmt(totalLabor);
    document.getElementById('recruitFeeRateDisplay').textContent = feeRate;
    document.getElementById('recruitFeeTotal').textContent = fmt(fee);
    document.getElementById('recruitGrandTotal').textContent = fmt(grandTotal);

    // 최종 제안가 자동 세팅
    const fp = document.getElementById('recruitFinalPrice');
    if (!state._recruitManual) {
        fp.value = grandTotal;
        fmtMoneyInput(fp);
    }

    const finalP = numElVal(fp);
    document.getElementById('recruitDiscount').textContent =
        finalP < grandTotal ? '할인: ' + fmt(grandTotal - finalP) + '원' :
        finalP > grandTotal ? '마진: +' + fmt(finalP - grandTotal) + '원' : '원가 동일';

    state.recruitTotal = grandTotal;
}

function addRecruitRow(job, career, salary, count) {
    const tbody = document.getElementById('recruitRows');
    const tr = document.createElement('tr');
    const jobVal = job || '';
    const careerVal = career || '신입';
    const salaryVal = salary || '2500000';
    const countVal = count || '1';
    tr.innerHTML = `<td><input type="text" value="${jobVal}" placeholder="직무명" style="width:100%;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
        <td style="text-align:center;"><select style="padding:4px;" onchange="calcRecruit(); autoSave();"><option${careerVal==='신입'?' selected':''}>신입</option><option${careerVal==='경력'?' selected':''}>경력</option></select></td>
        <td><input type="text" inputmode="numeric" data-money value="${parseInt(String(salaryVal).replace(/,/g,'')|| 0).toLocaleString('ko-KR')}" style="width:100%;text-align:right;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
        <td><input type="number" value="${countVal}" min="1" max="50" style="width:60px;text-align:center;padding:4px;" onchange="calcRecruit(); autoSave();"></td>
        <td class="num" style="font-weight:600;">-</td>
        <td><button onclick="removeRecruitRow(this)" style="background:none;border:none;color:#e53e3e;cursor:pointer;font-size:16px;">&times;</button></td>`;
    tbody.appendChild(tr);
    calcRecruit();
}

function removeRecruitRow(btn) {
    const tbody = document.getElementById('recruitRows');
    if (tbody.querySelectorAll('tr').length <= 1) {
        alert('최소 1개 직무는 필요합니다.');
        return;
    }
    btn.closest('tr').remove();
    calcRecruit();
    autoSave();
}

// ===== 업종 선택 시 팁 =====
function onIndustryChange() {
    const v = document.getElementById('industry').value;
    const tip = document.getElementById('industryTip');
    const tips = {
        '세차/주차': '시급 10,320~11,000원. 서비스 마인드 필요. 추천: 정액제 도급 / 일반 도급',
        '물류/택배': '야간 많음, 수당 비중 높음. 시급 10,500~12,000원. 추천: 일반 도급 / 정액제 도급',
        '제조라인': '불법파견 주의! 적법운영안내서 함께 제출 권장. 시급 10,500~13,000원. 추천: 정액제 도급',
        '사무/행정': '주간 운영, 전문성에 따라 편차. 마진 여유 높음. 추천: 정액제 도급 / 채용대행',
        'CS/콜센터': 'ASP 인프라 포함. AI 답변 시스템 연동 가능. 추천: CS대행 / CS쉐어링',
        '이커머스': 'CS 외주로 마케팅·상품 집중. 소규모 셀러 최적. 추천: CS쉐어링 / CS대행',
        '경비/시설': '24시간 격일근무 가능. 시급 10,320~11,000원. 추천: 정액제 도급',
        '호텔/숙박': '서비스 마인드 필수. 시급 10,500~12,000원. 추천: 정액제 도급',
        '식품제조': 'HACCP 위생관리 필수. 불법파견 주의. 시급 10,320~11,500원. 추천: 정액제 도급'
    };
    if (tips[v]) {
        tip.style.display = 'flex';
        tip.innerHTML = '<span>&#128161;</span><span><strong>' + v + ':</strong> ' + tips[v] + '</span>';
    } else {
        tip.style.display = 'none';
    }
}

// ===== 시간 파싱 유틸 =====
function parseTime(str) {
    // "HH:MM" 또는 "HH" → 시간(소수)으로 변환
    if (!str || str.trim() === '' || str.trim() === '-') return null;
    const parts = str.trim().split(':');
    const h = parseInt(parts[0]) || 0;
    const m = parseInt(parts[1]) || 0;
    return h + m / 60;
}

function fmtTime(decimal) {
    if (decimal === null || isNaN(decimal)) return '-';
    const h = Math.floor(decimal);
    const m = Math.round((decimal - h) * 60);
    return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0');
}

// ===== 교대 프리셋 =====
const shiftPresets = {
    day1: {
        desc: '주간 1교대 (사무, 소규모, 제조 주간 등). 1명부터 가능',
        shifts: 1, show3: false,
        s1: { start: '08:00', end: '17:00', ot: '' },
        s2: { start: '', end: '', ot: '' },
        s3: { start: '', end: '', ot: '' }
    },
    service: {
        desc: '영업시간을 교대로 나누어 커버 (서비스업, 호텔, 세차 등)',
        shifts: 2, show3: false,
        s1: { start: '08:00', end: '15:30', ot: '' },
        s2: { start: '15:30', end: '23:00', ot: '' },
        s3: { start: '', end: '', ot: '' }
    },
    mfg2: {
        desc: '주간/야간 2교대 (제조, 물류). 잔업시간 별도 입력 가능',
        shifts: 2, show3: false,
        s1: { start: '08:00', end: '17:00', ot: '19:00' },
        s2: { start: '19:00', end: '29:00', ot: '31:00' },
        s3: { start: '', end: '', ot: '' }
    },
    mfg12: {
        desc: '12시간 주야 2교대 (제조, 물류)',
        shifts: 2, show3: false,
        s1: { start: '08:00', end: '20:00', ot: '' },
        s2: { start: '20:00', end: '32:00', ot: '' },
        s3: { start: '', end: '', ot: '' }
    },
    mfg3: {
        desc: '8시간 3교대 연속 운영 (24시간 공장)',
        shifts: 3, show3: true,
        s1: { start: '08:00', end: '16:00', ot: '' },
        s2: { start: '16:00', end: '24:00', ot: '' },
        s3: { start: '24:00', end: '32:00', ot: '' }
    },
    custom: {
        desc: '교대조별 시간을 직접 입력하세요',
        shifts: 2, show3: false,
        s1: { start: '', end: '', ot: '' },
        s2: { start: '', end: '', ot: '' },
        s3: { start: '', end: '', ot: '' }
    }
};

function setShiftCount(n, btn, fromPreset) {
    // 교대수 버튼 선택 표시
    const group = document.getElementById('shiftCountGroup');
    group.querySelectorAll('.option-btn').forEach((b, i) => {
        b.classList.toggle('selected', i + 1 === n);
    });

    // 2교대/3교대 행 표시/숨김
    document.getElementById('shift2Row').style.display = n >= 2 ? '' : 'none';
    document.getElementById('shift3Row').style.display = n >= 3 ? '' : 'none';

    // 숨겨진 교대 시간 초기화 (시간값 없으면 인원계산에서 안 잡힘)
    if (n < 2) {
        document.getElementById('s2Start').value = '';
        document.getElementById('s2End').value = '';
        document.getElementById('s2OT').value = '';
    }
    if (n < 3) {
        document.getElementById('s3Start').value = '';
        document.getElementById('s3End').value = '';
        document.getElementById('s3OT').value = '';
    }

    state.shiftCount = n;
    if (!fromPreset) {
        calcPersonnel();
        autoSave();
    }
}

function applyShiftPreset(key, btn) {
    // 버튼 선택 표시
    btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    state.shiftPreset = key;

    const preset = shiftPresets[key];
    document.getElementById('presetDesc').textContent = preset.desc;

    // 시간 필드 채우기
    ['s1','s2','s3'].forEach(s => {
        document.getElementById(s + 'Start').value = preset[s].start;
        document.getElementById(s + 'End').value = preset[s].end;
        document.getElementById(s + 'OT').value = preset[s].ot;
    });

    // 교대수 버튼 연동 (프리셋의 기본 교대수로 세팅)
    const shiftN = preset.show3 ? 3 : preset.shifts;
    setShiftCount(shiftN, null, true);

    calcPersonnel();
    autoSave();
}

// ===== 인원 산출 =====
function calcPersonnel() {
    const perShift = parseInt(document.getElementById('perShift').value) || 4;
    const opDaysMap = { '주1일':1,'주2일':2,'주3일':3,'주4일':4,'주5일':5,'주6일':6,'주7일':7 };
    const opDays = opDaysMap[state.opDays] || 7;
    const hasManager = state.manager === '1명 배치';

    // 야간 인정 시간대 (설정값)
    const nightStartH = parseInt(document.getElementById('nightStart')?.value) || 22;
    const nightEndH = parseInt(document.getElementById('nightEnd')?.value) || 6;

    // 교대조별 시간 계산
    const shiftData = [];
    let totalWorkHours = 0;
    let totalNightHours = 0;
    let shiftCount = 0;

    [1,2,3].forEach(i => {
        const startStr = document.getElementById('s'+i+'Start').value;
        const endStr = document.getElementById('s'+i+'End').value;
        const otStr = document.getElementById('s'+i+'OT').value;

        const start = parseTime(startStr);
        const end = parseTime(endStr);
        const ot = parseTime(otStr);

        if (start !== null && end !== null && end > start) {
            const workH = end - start;
            const otH = (ot !== null && ot > end) ? ot - end : 0;
            const totalH = workH + otH;

            // 야간시간 계산 (22~30(=06) 범위의 시간 계산)
            let nightH = calcNightHours(start, end + otH, nightStartH, nightEndH);

            shiftData.push({ idx: i, start, end, ot, workH, otH, totalH, nightH });
            totalWorkHours += totalH;
            totalNightHours += nightH;
            shiftCount++;

            // 시간 표시 업데이트
            const hStr = totalH % 1 === 0 ? totalH + 'h' : totalH.toFixed(1) + 'h';
            document.getElementById('s'+i+'Hours').textContent = hStr + (nightH > 0 ? ' (야' + nightH.toFixed(1) + 'h)' : '');
        } else {
            document.getElementById('s'+i+'Hours').textContent = '-';
        }
    });

    if (shiftCount === 0) shiftCount = 2; // 기본값

    const dailyShifts = perShift * shiftCount;
    const rawPersonnel = dailyShifts * opDays / 5;
    const personnel = Math.ceil(rawPersonnel);

    // 전체 운영 시간 범위
    const firstStart = shiftData.length > 0 ? shiftData[0].start : 8;
    const lastEnd = shiftData.length > 0 ? shiftData[shiftData.length-1].end + (shiftData[shiftData.length-1].otH || 0) : 23;

    document.getElementById('totalPersonnel').textContent = personnel + '명';
    document.getElementById('personnelFormula').textContent =
        perShift + '명 × ' + shiftCount + '교대 × ' + opDays + '일 ÷ 5일 = ' +
        rawPersonnel.toFixed(1) + ' → ' + personnel + '명';

    document.getElementById('managerInfo').textContent =
        hasManager ? '+ 현장관리자 1명' : '(현장관리자 미배치)';

    // 상세 테이블
    let detailHTML = '';
    shiftData.forEach(s => {
        const label = s.idx + '교대';
        const timeStr = fmtTime(s.start) + '~' + fmtTime(s.end) + (s.otH > 0 ? ' (잔업~' + fmtTime(s.end + s.otH) + ')' : '');
        detailHTML += '<tr><td>' + label + '</td><td class="num">' + timeStr + ' / ' + s.totalH.toFixed(1) + 'h</td></tr>';
    });
    detailHTML += '<tr><td>운영일</td><td class="num">' + state.opDays + '</td></tr>';
    detailHTML += '<tr><td>일일 man-shifts</td><td class="num">' + dailyShifts + '</td></tr>';

    const nightStr = totalNightHours > 0
        ? nightStartH + ':00~' + (nightEndH < 10 ? '0' : '') + nightEndH + ':00 (일 ' + totalNightHours.toFixed(1) + 'h)'
        : '없음';
    detailHTML += '<tr><td>야간 시간대</td><td class="num">' + nightStr + '</td></tr>';
    detailHTML += '<tr><td><strong>산출 인원</strong></td><td class="num highlight"><strong>' + personnel + '명</strong></td></tr>';
    if (hasManager) {
        detailHTML += '<tr><td>현장관리자</td><td class="num">+1명 (별도)</td></tr>';
    }

    document.getElementById('personnelDetail').innerHTML = detailHTML;

    // 야간수당 자동 계산 (심야가산율 적용)
    const nightRate = (parseFloat(document.getElementById('rateNight').value) || 50) / 100;
    if (totalNightHours > 0) {
        const wage = numVal('hourlyWage') || 10500;
        const monthlyNight = Math.round(wage * nightRate * totalNightHours * personnel * opDays * 52 / 12);
        const npEl = document.getElementById('nightPay');
        npEl.value = Math.round(monthlyNight / 10000) * 10000;
        fmtMoneyInput(npEl);
    } else {
        document.getElementById('nightPay').value = 0;
    }

    // 오버라이드 박스 표시: 올림이 발생한 경우 (rawPersonnel과 personnel이 다를 때)
    const overrideBox = document.getElementById('personnelOverrideBox');
    const overrideInput = document.getElementById('personnelOverride');
    if (rawPersonnel !== personnel && rawPersonnel > 0) {
        overrideBox.style.display = '';
        if (!overrideInput.value) {
            // 오버라이드 값이 없으면 자동 계산 값 사용
        }
    } else {
        overrideBox.style.display = 'none';
        overrideInput.value = '';
    }

    // 오버라이드 값이 있으면 그것을 사용
    const finalPersonnel = overrideInput.value ? parseInt(overrideInput.value) : personnel;

    // 전역 저장
    state.personnel = finalPersonnel;
    state.personnelCalc = personnel; // 자동 계산값 보관
    state.nightHours = totalNightHours;
    state.shiftCount = shiftCount;
    state.shifts = shiftCount + '교대';
}

// ===== 인원 오버라이드 =====
function applyPersonnelOverride() {
    const val = parseInt(document.getElementById('personnelOverride').value);
    if (val && val > 0) {
        state.personnel = val;
        calcCost();
    }
}

function clearPersonnelOverride() {
    document.getElementById('personnelOverride').value = '';
    state.personnel = state.personnelCalc || state.personnel;
    calcCost();
    calcPersonnel(); // 재계산하여 원래 값 복원
}

// 야간시간 계산 (24시간 기준 래핑 처리)
function calcNightHours(start, end, nightStart, nightEnd) {
    // nightStart=22, nightEnd=6 → 야간대 = 22~30(6+24)
    let nightH = 0;
    const ns = nightStart; // 22
    const ne = nightEnd + 24; // 30

    // shift가 일반 시간대일 때 (예: 8~17)
    // shift가 야간을 걸칠 때 (예: 19~29=05시)
    const overlapStart = Math.max(start, ns);
    const overlapEnd = Math.min(end, ne);
    if (overlapEnd > overlapStart) nightH += overlapEnd - overlapStart;

    // 24시를 넘는 경우 (다음날 야간 시작 전까지)
    // 예: start=24, end=32(=08) → 24~30 구간만 야간
    if (start >= 24) {
        // 이미 위에서 처리됨
    }

    return Math.max(0, nightH);
}

// ===== 원가 계산 =====
function calcCost() {
    const wage = numVal('hourlyWage') || 10500;
    const personnel = state.personnel || 12;
    const nightPay = numVal('nightPay');
    const etcCost = numVal('etcCost');

    // 요율 읽기 (조정 가능)
    const rPension = (parseFloat(document.getElementById('ratePension').value) || 4.5) / 100;
    const rHealth = (parseFloat(document.getElementById('rateHealth').value) || 3.545) / 100;
    const rEmploy = (parseFloat(document.getElementById('rateEmploy').value) || 0.9) / 100;
    const rIndust = (parseFloat(document.getElementById('rateIndust').value) || 1.5) / 100;
    const rRetire = (parseFloat(document.getElementById('rateRetire').value) || 8.33) / 100;

    const baseWage = wage * 209;
    const pension = Math.round(baseWage * rPension);
    const health = Math.round(baseWage * rHealth);
    const employ = Math.round(baseWage * rEmploy);
    const indust = Math.round(baseWage * rIndust);
    const insurance = pension + health + employ + indust;
    const retire = Math.round(baseWage * rRetire);
    const perPerson = baseWage + insurance + retire;
    const laborTotal = perPerson * personnel;
    const totalCost = laborTotal + nightPay + etcCost;

    // 배율 계산
    const multiplier = (perPerson / baseWage).toFixed(4);

    document.getElementById('baseWage').textContent = fmt(baseWage) + '원';

    let html = '';
    html += '<tr><td>기본급 (시급 × 209h)</td><td class="num">' + fmt(baseWage) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr><td>&nbsp;&nbsp;국민연금 (' + (rPension*100).toFixed(1) + '%)</td><td class="num">' + fmt(pension) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr><td>&nbsp;&nbsp;건강보험 (' + (rHealth*100).toFixed(3) + '%)</td><td class="num">' + fmt(health) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr><td>&nbsp;&nbsp;고용보험 (' + (rEmploy*100).toFixed(1) + '%)</td><td class="num">' + fmt(employ) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr><td>&nbsp;&nbsp;산재보험 (' + (rIndust*100).toFixed(1) + '%)</td><td class="num">' + fmt(indust) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr><td>&nbsp;&nbsp;퇴직금충당 (' + (rRetire*100).toFixed(2) + '%)</td><td class="num">' + fmt(retire) + '원</td><td class="num">1인당</td></tr>';
    html += '<tr style="background:#f7fafc;"><td><strong>1인당 총비용</strong></td><td class="num highlight"><strong>' + fmt(perPerson) + '원</strong></td><td class="num">× ' + multiplier + '</td></tr>';
    html += '<tr><td>인건비 소계 (' + personnel + '명)</td><td class="num">' + fmt(laborTotal) + '원</td><td></td></tr>';
    html += '<tr><td>야간수당</td><td class="num">' + fmt(nightPay) + '원</td><td></td></tr>';
    html += '<tr><td>기타비용 (유니폼/교육/채용)</td><td class="num">' + fmt(etcCost) + '원</td><td></td></tr>';

    document.getElementById('costDetail').innerHTML = html;
    document.getElementById('totalCost').textContent = fmt(totalCost) + '원';

    // 원가가 바뀌면 시뮬레이션 제시가 자동 갱신 (수동 입력 잠금 해제)
    if (state.totalCost !== undefined && state.totalCost !== totalCost) {
        state._manualQuote = false;
    }

    state.totalCost = totalCost;
    state.perPerson = perPerson;

    // 시뮬레이션 기본값 자동 설정
    document.getElementById('simBaseCost').textContent = fmtMan(totalCost) + '만원';

    // 시나리오 기본값 제안
    const suggested1 = Math.ceil(totalCost / 10000 * 1.25 / 100) * 100; // 25% 마진
    const suggested2 = Math.ceil(totalCost / 10000 * 1.20 / 100) * 100; // 20% 마진
    const suggested3 = Math.ceil(totalCost / 10000 * 1.15 / 100) * 100; // 15% 마진

    if (!state._manualQuote) {
        document.getElementById('simQuote1').value = suggested1;
        document.getElementById('simQuote2').value = suggested2;
        document.getElementById('simQuote3').value = suggested3;

        // 항목 분배 자동
        document.getElementById('itemDogup').value = Math.round(suggested1 * 0.89 / 100) * 100;
        document.getElementById('itemManage').value = Math.round(suggested1 * 0.067 / 50) * 50;
        document.getElementById('itemAdmin').value = suggested1 - document.getElementById('itemDogup').valueAsNumber - document.getElementById('itemManage').valueAsNumber;
    }

    updateScenarios();
    updateItemTotal();
}

// ===== 시뮬레이션 =====
function updateScenarios(fromUser) {
    if (fromUser) state._manualQuote = true;
    const cost = state.totalCost || 0;
    [1,2,3].forEach(i => {
        const quote = (parseInt(document.getElementById('simQuote'+i).value) || 0) * 10000;
        const profit = quote - cost;
        const margin = quote > 0 ? (profit / quote * 100) : 0;

        document.getElementById('simProfit'+i).textContent = fmtMan(profit) + '만원';
        document.getElementById('simMargin'+i).textContent = margin.toFixed(1) + '%';

        // 색상 표시
        const el = document.getElementById('simMargin'+i);
        if (margin < 15) el.style.color = '#e53e3e';
        else if (margin < 20) el.style.color = '#ed8936';
        else el.style.color = '#38a169';
    });
}

function updateItemTotal() {
    const d = parseInt(document.getElementById('itemDogup').value) || 0;
    const m = parseInt(document.getElementById('itemManage').value) || 0;
    const a = parseInt(document.getElementById('itemAdmin').value) || 0;
    const total = d + m + a;
    document.getElementById('itemTotal').textContent = fmt(total) + '만원';

    const quote1 = parseInt(document.getElementById('simQuote1').value) || 0;
    const mismatch = document.getElementById('itemMismatch');
    if (total !== quote1) {
        mismatch.style.display = 'block';
    } else {
        mismatch.style.display = 'none';
    }
}

// ===== 견적서 생성 (유형별 분기) =====
function generateQuote() {
    const type = state.quoteType || 'outsource';
    if (type === 'outsource') return generateQuoteOutsource();
    if (type === 'labor') return generateQuoteLabor();
    if (type === 'cs-agent') return generateQuoteCSAgent();
    if (type === 'cs-share') return generateQuoteCSShare();
    if (type === 'recruit') return generateQuoteRecruit();
    if (type === 'dispatch') return generateQuoteDispatch();
    return generateQuoteOutsource(); // fallback
}

// --- 워크위드 로고 (base64) ---
const WW_LOGO = 'data:image/png;base64,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';
const WW_SEAL = 'data:image/png;base64,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';

// --- 공통 견적서 CSS ---
function getQuoteCSS() {
    return `* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Noto Sans KR',sans-serif; background:#f0f0f0; color:#333; font-size:13px; line-height:1.75; font-weight:400; letter-spacing:-0.02em; }
.document { max-width:210mm; margin:20px auto; background:#fff; box-shadow:0 2px 20px rgba(0,0,0,0.1); }
.header { padding:40px 50px 30px; border-bottom:3px solid #1a365d; }
.header-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:30px; }
.header h1 { font-size:30px; font-weight:600; color:#1a365d; letter-spacing:12px; }
.header-info { text-align:right; font-size:12px; color:#666; line-height:1.8; }
.header-info .label { color:#999; margin-right:8px; }
.total-box { background:#f8fafc; border:2px solid #1a365d; border-radius:8px; padding:20px 30px; display:flex; justify-content:space-between; align-items:center; }
.total-label { font-size:14px; font-weight:500; color:#1a365d; }
.total-amount { font-size:22px; font-weight:600; color:#1a365d; }
.total-sub { font-size:12px; color:#888; margin-top:4px; }
.body { padding:30px 50px 40px; }
.parties { display:flex; gap:40px; margin-bottom:30px; }
.party { flex:1; background:#fafafa; border-radius:6px; padding:18px 22px; }
.party-title { font-size:11px; color:#1a365d; font-weight:600; letter-spacing:1px; margin-bottom:10px; padding-bottom:8px; border-bottom:1px solid #e2e8f0; }
.party-table { width:100%; }
.party-table td { padding:4px 0; font-size:12px; vertical-align:top; }
.party-table td:first-child { color:#888; width:60px; }
.party-table td:last-child { font-weight:500; }
.section { margin-bottom:28px; }
.section-title { font-size:14px; font-weight:600; color:#1a365d; padding-bottom:8px; border-bottom:1px solid #cbd5e0; margin-bottom:15px; }
.section-title .num { display:inline-block; background:#1a365d; color:#fff; width:20px; height:20px; border-radius:50%; text-align:center; line-height:20px; font-size:10px; margin-right:8px; }
table.qt { width:100%; border-collapse:collapse; margin:10px 0; }
table.qt thead th { background:#1a365d; color:#fff; padding:10px 14px; font-size:11px; font-weight:500; text-align:center; }
table.qt thead th:first-child { text-align:left; }
table.qt tbody td { padding:10px 14px; border-bottom:1px solid #e2e8f0; font-size:12px; text-align:center; }
table.qt tbody td:first-child { text-align:left; }
table.qt tfoot td { padding:12px 14px; border-top:2px solid #1a365d; font-size:13px; font-weight:600; }
.highlight { color:#1a365d; font-weight:600; font-size:14px; }
.note-box { background:#f7fafc; border:1px solid #e2e8f0; border-radius:6px; padding:16px 20px; font-size:12px; line-height:1.8; }
.footer { text-align:center; padding:20px; font-size:11px; color:#a0aec0; border-top:1px solid #edf2f7; }
.logo-area { text-align:center; padding:20px 0 10px; }
@page { size:A4; margin:8mm; }
@media print { * { -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important; } body { background:#fff; margin:0; padding:0; } .document { box-shadow:none; margin:0; } .header { padding:25px 30px 20px; } .body { padding:20px 30px 25px; } .section { margin-bottom:18px; page-break-inside:avoid; } table.qt thead { display:table-header-group; } }`;
}

function getQuoteHeader(title, quoteNum, quoteDate, totalLabel, totalAmount) {
    return `<div class="header">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;">
        <h1>${title}</h1>
        <img src="${WW_LOGO}" alt="Walk With" style="height:36px;">
    </div>
    <div style="text-align:right;font-size:12px;color:#666;line-height:1.8;margin-bottom:20px;">
        <p><span class="label">견적번호</span> ${quoteNum}</p>
        <p><span class="label">견적일자</span> ${quoteDate}</p>
        <p><span class="label">유효기간</span> 견적일로부터 30일</p>
    </div>
    <div class="total-box">
        <div>
            <div class="total-label">${totalLabel}</div>
            <div class="total-sub">부가가치세 별도</div>
        </div>
        <div style="text-align:right;">
            <div class="total-amount">${totalAmount}</div>
            <div class="total-sub">VAT 별도</div>
        </div>
    </div>
</div>`;
}

function getQuoteParties(client, site, contact) {
    return `<div class="parties">
    <div class="party">
        <div class="party-title">수 신</div>
        <table class="party-table">
            <tr><td>업체명</td><td>${client}</td></tr>
            <tr><td>사업장</td><td>${site}</td></tr>
            ${contact ? '<tr><td>담당자</td><td>'+contact+'</td></tr>' : ''}
        </table>
    </div>
    <div class="party">
        <div class="party-title">발 신</div>
        <table class="party-table">
            <tr><td>업체명</td><td>주식회사 워크위드</td></tr>
            <tr><td>TEL</td><td>1600-9878</td></tr>
            <tr><td>FAX</td><td>043-912-9913</td></tr>
            <tr><td>주소</td><td>충주시 예성로 392, 롯데프라자 4층 401호</td></tr>
            <tr><td>대표</td><td>한 세 은</td></tr>
        </table>
    </div>
</div>`;
}

function getQuoteSignature() {
    return `<div style="margin-top:30px; padding:0 30px 15px; display:flex; justify-content:flex-end; page-break-inside:avoid;">
    <div style="text-align:center; position:relative; min-width:240px;">
        <p style="font-size:15px; font-weight:600; color:#1a365d; margin-bottom:8px;">주식회사 워크위드</p>
        <div style="position:relative; display:inline-block;">
            <span style="font-size:13px; color:#555;">대표이사 &nbsp; 한 세 은</span>
            <img src="${WW_SEAL}" style="position:absolute; top:-15px; right:-35px; width:50px; height:50px; opacity:0.85;" alt="직인">
        </div>
        <div style="margin-top:14px; font-size:10px; color:#999; text-align:center; line-height:1.6;">
            <p>본사 : 충북 충주시 예성로 392, 롯데프라자 4층 401호</p>
            <p>지사 : 서울 중구 퇴계로 15, 에너지플러스 서울로 517호</p>
        </div>
    </div>
</div>`;
}

function showQuotePreview(quoteHTML) {
    const preview = document.getElementById('quotePreview');
    preview.innerHTML = '<div class="preview-frame"><iframe id="quoteFrame"></iframe></div>';
    const iframe = document.getElementById('quoteFrame');
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    doc.open();
    doc.write(quoteHTML);
    doc.close();
    state.quoteHTML = quoteHTML;
    autoSave();
}

// ===== 정액제 도급 견적서 =====
function generateQuoteOutsource() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '(사업장)';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WW-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-01';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const dogup = parseInt(document.getElementById('itemDogup').value) || 0;
    const manage = parseInt(document.getElementById('itemManage').value) || 0;
    const admin = parseInt(document.getElementById('itemAdmin').value) || 0;
    const total = dogup + manage + admin;

    // 교대조에서 시간 범위 도출
    const s1s = document.getElementById('s1Start').value || '08:00';
    const s1e = document.getElementById('s1End').value || '23:00';
    const s2e = document.getElementById('s2End').value || '';
    const s3e = document.getElementById('s3End').value || '';
    const openTime = s1s;
    const lastEnd = parseTime(s3e) || parseTime(s2e) || parseTime(s1e) || 23;
    const closeStr = lastEnd >= 24 ? '24:00' : fmtTime(lastEnd);
    const perShift = document.getElementById('perShift').value;

    const workLines = (document.getElementById('workScope').value || '').split('\n').filter(l => l.trim());
    const noteLines = (document.getElementById('outsourceNotes').value || '').split('\n').filter(l => l.trim());

    const quoteHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>견적서 - ${client} ${site} 인력운영 위탁도급</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Noto Sans KR',sans-serif; background:#f0f0f0; color:#333; font-size:13px; line-height:1.75; font-weight:400; letter-spacing:-0.02em; }
        .document { max-width:210mm; margin:20px auto; background:#fff; box-shadow:0 2px 20px rgba(0,0,0,0.1); }
        .header { padding:40px 50px 30px; border-bottom:3px solid #1a365d; }
        .header-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:30px; }
        .header h1 { font-size:30px; font-weight:600; color:#1a365d; letter-spacing:12px; }
        .header-info { text-align:right; font-size:12px; color:#666; line-height:1.8; }
        .header-info .label { color:#999; margin-right:8px; }
        .total-box { background:#f8fafc; border:2px solid #1a365d; border-radius:8px; padding:20px 30px; display:flex; justify-content:space-between; align-items:center; }
        .total-label { font-size:14px; font-weight:500; color:#1a365d; }
        .total-amount { font-size:22px; font-weight:600; color:#1a365d; }
        .total-sub { font-size:12px; color:#888; margin-top:4px; }
        .body { padding:30px 50px 40px; }
        .parties { display:flex; gap:40px; margin-bottom:30px; }
        .party { flex:1; background:#fafafa; border-radius:6px; padding:18px 22px; }
        .party-title { font-size:11px; color:#1a365d; font-weight:600; letter-spacing:1px; margin-bottom:10px; padding-bottom:8px; border-bottom:1px solid #e2e8f0; }
        .party-table { width:100%; }
        .party-table td { padding:4px 0; font-size:12px; vertical-align:top; }
        .party-table td:first-child { color:#888; width:60px; }
        .party-table td:last-child { font-weight:500; }
        .section { margin-bottom:28px; }
        .section-title { font-size:14px; font-weight:600; color:#1a365d; padding-bottom:8px; border-bottom:1px solid #cbd5e0; margin-bottom:15px; }
        .section-title .num { display:inline-block; background:#1a365d; color:#fff; width:20px; height:20px; border-radius:50%; text-align:center; line-height:20px; font-size:10px; margin-right:8px; }
        table.qt { width:100%; border-collapse:collapse; margin:10px 0; }
        table.qt thead th { background:#1a365d; color:#fff; padding:10px 14px; font-size:11px; font-weight:500; text-align:center; }
        table.qt thead th:first-child { text-align:left; }
        table.qt tbody td { padding:10px 14px; border-bottom:1px solid #e2e8f0; font-size:12px; text-align:center; }
        table.qt tbody td:first-child { text-align:left; }
        table.qt tfoot td { padding:12px 14px; border-top:2px solid #1a365d; font-size:13px; font-weight:600; }
        .highlight { color:#1a365d; font-weight:600; font-size:14px; }
        .note-box { background:#f7fafc; border:1px solid #e2e8f0; border-radius:6px; padding:16px 20px; font-size:12px; line-height:1.8; }
        .footer { text-align:center; padding:20px; font-size:11px; color:#a0aec0; border-top:1px solid #edf2f7; }
        @page { size:A4; margin:8mm; }
        @media print { * { -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important; } body { background:#fff; margin:0; padding:0; } .document { box-shadow:none; margin:0; } .header { padding:25px 30px 20px; } .body { padding:20px 30px 25px; } .section { margin-bottom:18px; page-break-inside:avoid; } }
    </style>
</head>
<body>
<div class="document">
    <div class="header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;">
            <h1>견 적 서</h1>
            <img src="${WW_LOGO}" alt="Walk With" style="height:36px;">
        </div>
        <div style="text-align:right;font-size:12px;color:#666;line-height:1.8;margin-bottom:20px;">
            <p><span class="label">견적번호</span> ${quoteNum}</p>
            <p><span class="label">견적일자</span> ${quoteDate}</p>
            <p><span class="label">유효기간</span> 견적일로부터 30일</p>
        </div>
        <div class="total-box">
            <div>
                <div class="total-label">${site} 운영 위탁 월 도급비</div>
                <div class="total-sub">부가가치세 별도</div>
            </div>
            <div style="text-align:right;">
                <div class="total-amount">월 ${fmt(total * 10000)}원</div>
                <div class="total-sub">금 ${numToKorean(total * 10000)}원정 (VAT 별도)</div>
            </div>
        </div>
    </div>

    <div class="body">
        ${getQuoteParties(client, site, contact)}

        ${workLines.length > 0 ? `
        <div class="section">
            <div class="section-title"><span class="num">1</span>위탁 개요</div>
            <table class="qt">
                <thead><tr><th style="text-align:left;">항목</th><th style="width:200px;">내용</th></tr></thead>
                <tbody>
                    <tr><td style="text-align:left;">위탁 사업장</td><td>${client} ${site}</td></tr>
                    <tr><td style="text-align:left;">운영 시간</td><td>${openTime} ~ ${closeStr} / ${state.opDays}</td></tr>
                    <tr><td style="text-align:left;">운영 방식</td><td>${state.shifts} 운영</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-title"><span class="num">2</span>업무 범위</div>
            <table class="qt">
                <thead><tr><th style="text-align:left;">#</th><th style="text-align:left;">업무 내용</th></tr></thead>
                <tbody>
                    ${workLines.map((l,i) => '<tr><td style="text-align:left;width:40px;">'+(i+1)+'</td><td style="text-align:left;">'+l.trim()+'</td></tr>').join('')}
                </tbody>
            </table>
        </div>
        ` : ''}

        <div class="section">
            <div class="section-title"><span class="num">3</span>견적 금액</div>
            <table class="qt">
                <thead><tr><th style="text-align:left;">항목</th><th style="width:140px;">단위</th><th style="width:160px;">금액</th></tr></thead>
                <tbody>
                    <tr>
                        <td style="text-align:left;"><strong>${site} 운영 위탁 도급비</strong><br><span style="font-size:11px;color:#888;">${openTime}~${closeStr} / ${state.opDays} / ${state.shifts} 전 시간대 커버</span></td>
                        <td>월 정액</td>
                        <td>${fmt(dogup * 10000)}원</td>
                    </tr>
                    <tr>
                        <td style="text-align:left;"><strong>현장관리비</strong><br><span style="font-size:11px;color:#888;">현장관리자 상시 배치, 품질·근태 관리</span></td>
                        <td>월 정액</td>
                        <td>${fmt(manage * 10000)}원</td>
                    </tr>
                    <tr>
                        <td style="text-align:left;"><strong>관리운영비</strong><br><span style="font-size:11px;color:#888;">보험, 유니폼, 교육, 채용·충원 비용</span></td>
                        <td>월 정액</td>
                        <td>${fmt(admin * 10000)}원</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td style="text-align:left;"><strong>합계 (부가세 별도)</strong></td>
                        <td></td>
                        <td class="highlight">${fmt(total * 10000)}원</td>
                    </tr>
                </tfoot>
            </table>

            <div class="note-box" style="margin-top:12px;">
                <p><strong>서비스 보장 기준</strong></p>
                <p>· 영업시간(${openTime}~${closeStr}) 전 시간대 운영인력 배치 보장</p>
                <p>· 교대당 최소 <strong>${perShift}명 이상</strong> 현장 배치</p>
                ${state.manager === '1명 배치' ? '<p>· 현장관리자 <strong>상시 1명</strong> 배치</p>' : ''}
                <p>· 결원 발생 시 <strong>당일 충원</strong></p>
                <p style="margin-top:6px;color:#888;font-size:11px;">※ 인력 배치 규모는 당사가 서비스 품질 기준에 따라 자체 결정합니다.</p>
            </div>
        </div>

        ${getServiceDescription('outsource')}
        ${getIndustryPackage()}

        <div class="section">
            <div class="section-title"><span class="num">4</span>특기사항</div>
            <div class="note-box">
                ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
            </div>
        </div>
    </div>

        ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div>
</body>
</html>`;

    showQuotePreview(quoteHTML);
}

// ===== 일반 도급 견적서 (인건비 기반 1인 단가) =====
function generateQuoteLabor() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WW-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-001';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const wage = numVal('hourlyWage') || 10500;
    const baseWage = wage * 209;
    const rPension = (parseFloat(document.getElementById('ratePension').value) || 4.5) / 100;
    const rHealth = (parseFloat(document.getElementById('rateHealth').value) || 3.545) / 100;
    const rEmploy = (parseFloat(document.getElementById('rateEmploy').value) || 0.9) / 100;
    const rIndust = (parseFloat(document.getElementById('rateIndust').value) || 1.5) / 100;
    const rRetire = (parseFloat(document.getElementById('rateRetire').value) || 8.33) / 100;
    const longCare = (parseFloat(document.getElementById('laborLongCare')?.value) || 13.14) / 100;
    const bizTax = (parseFloat(document.getElementById('laborBizTax')?.value) || 0.5) / 100;
    const transport = numVal('laborTransport') || 0;
    const nightPay = numVal('nightPay') || 0;
    const leaderPay = numVal('laborLeaderPay') || 100000;
    const laborMgmtRaw = parseFloat(document.getElementById('laborMgmtFee')?.value);
    const mgmtPct = isNaN(laborMgmtRaw) ? 8 : laborMgmtRaw;

    // 계산
    const pension = Math.round(baseWage * rPension);
    const health = Math.round(baseWage * rHealth);
    const longCareAmt = Math.round(health * longCare);
    const employ = Math.round(baseWage * rEmploy);
    const indust = Math.round(baseWage * rIndust);
    const bizTaxAmt = Math.round(baseWage * bizTax);
    const retire = Math.round(baseWage * rRetire); // 발생시 청구
    const annualLeave = Math.round(wage * 8); // 연차수당 = 통상시급×8h

    const laborSub1 = baseWage + transport + nightPay;
    const laborSub2 = annualLeave;
    const laborTotal = laborSub1 + laborSub2;
    const insuranceTotal = pension + health + longCareAmt + employ + indust + bizTaxAmt;
    const subtotal = laborTotal + insuranceTotal;
    const mgmtAmt = Math.round(subtotal * mgmtPct / 100);
    const perPersonTotal = subtotal + mgmtAmt;

    // 시간 정보
    const s1s = document.getElementById('s1Start').value || '09:00';
    const s1e = document.getElementById('s1End').value || '18:00';

    const workLines = (document.getElementById('workScope').value || '').split('\n').filter(l => l.trim());
    const noteLines = (document.getElementById('laborNotes').value || '').split('\n').filter(l => l.trim());

    const quoteHTML = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>도급견적서 - ${client}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>${getQuoteCSS()}</style></head><body>
<div class="document">
${getQuoteHeader('도 급 견 적 서', quoteNum, quoteDate, client + ' 도급 운영 위탁', '1인 단가 ' + fmt(perPersonTotal) + '원')}
<div class="body">
${getQuoteParties(client, site || '-', contact)}

<div class="section">
    <div class="section-title"><span class="num">1</span>견적 내용</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">항목</th><th>내용</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">내용</td><td>${client} ${workLines.length > 0 ? workLines[0] : '도급 운영 위탁'}</td></tr>
            <tr><td style="text-align:left;">운영시간</td><td>${s1s}~${s1e}</td></tr>
            <tr><td style="text-align:left;">운영장소</td><td>${site || '-'}</td></tr>
            <tr><td style="text-align:left;">인력 근무조건</td><td>일 8시간 근무 기준 (${state.opDays})</td></tr>
            ${workLines.length > 0 ? '<tr><td style="text-align:left;">업무범위</td><td>' + workLines.join(', ') + '</td></tr>' : ''}
        </tbody>
    </table>
</div>

<div class="section">
    <div class="section-title"><span class="num">2</span>운영 예산안 <span style="font-size:11px;font-weight:400;color:#888;">(적용시급: ${fmt(wage)}원) (단위: 원)</span></div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">계정과목</th><th style="text-align:left;">세부내용</th><th>산출내역</th><th style="text-align:right;">합계</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;" rowspan="${2 + (transport > 0 ? 1 : 0) + (nightPay > 0 ? 1 : 0)}"><strong>직접노무비</strong><br>(급여)</td>
                <td style="text-align:left;">기본급</td><td>적용시급×209시간</td><td style="text-align:right;">${fmt(baseWage)}</td></tr>
            ${transport > 0 ? '<tr><td style="text-align:left;">교통비</td><td></td><td style="text-align:right;">' + fmt(transport) + '</td></tr>' : ''}
            ${nightPay > 0 ? '<tr><td style="text-align:left;">야간수당</td><td></td><td style="text-align:right;">' + fmt(nightPay) + '</td></tr>' : ''}
            <tr><td style="text-align:left;"><strong>① 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(laborSub1)}</td></tr>

            <tr><td style="text-align:left;" rowspan="3"></td>
                <td style="text-align:left;">퇴직금</td><td></td><td style="text-align:right;color:#888;">발생시 청구</td></tr>
            <tr><td style="text-align:left;">연차수당</td><td>통상시급×8시간</td><td style="text-align:right;">${fmt(annualLeave)}</td></tr>
            <tr><td style="text-align:left;"><strong>② 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(laborSub2)}</td></tr>

            <tr style="background:#f0f5ff;"><td style="text-align:left;" colspan="2"><strong>③ 합계 (①+②)</strong></td><td></td><td style="text-align:right;font-weight:700;">${fmt(laborTotal)}</td></tr>

            <tr><td style="text-align:left;" rowspan="7"><strong>간접노무비</strong><br>(4대보험)</td>
                <td style="text-align:left;">국민연금</td><td>임금 합계×${(rPension*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(pension)}</td></tr>
            <tr><td style="text-align:left;">건강보험</td><td>임금 합계×${(rHealth*100).toFixed(3)}%</td><td style="text-align:right;">${fmt(health)}</td></tr>
            <tr><td style="text-align:left;">장기요양보험</td><td>건강보험료×${(longCare*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(longCareAmt)}</td></tr>
            <tr><td style="text-align:left;">고용보험</td><td>임금 합계×${(rEmploy*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(employ)}</td></tr>
            <tr><td style="text-align:left;">산재보험</td><td>임금 합계×${(rIndust*100).toFixed(3)}%</td><td style="text-align:right;">${fmt(indust)}</td></tr>
            <tr><td style="text-align:left;">사업소세</td><td>임금 합계×${(bizTax*100).toFixed(1)}%</td><td style="text-align:right;">${fmt(bizTaxAmt)}</td></tr>
            <tr><td style="text-align:left;"><strong>④ 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(insuranceTotal)}</td></tr>

            <tr style="background:#f0f5ff;"><td style="text-align:left;" colspan="2"><strong>⑤ 합계 (③+④)</strong></td><td></td><td style="text-align:right;font-weight:700;">${fmt(subtotal)}</td></tr>

            <tr><td style="text-align:left;"><strong>수수료</strong></td>
                <td style="text-align:left;">관리 수수료</td><td>${mgmtPct}%</td><td style="text-align:right;">${fmt(mgmtAmt)}</td></tr>
        </tbody>
        <tfoot>
            <tr><td style="text-align:left;" colspan="2"><strong>총계 (⑤+수수료) — 1인기준 (VAT 별도)</strong></td><td></td><td style="text-align:right;" class="highlight">${fmt(perPersonTotal)}</td></tr>
            <tr><td style="text-align:left;" colspan="2">월 청구 예상액</td><td></td><td style="text-align:right;color:#888;">실 투입 인원 × 1인 단가 적용</td></tr>
        </tfoot>
    </table>
</div>

${getServiceDescription('labor')}
${getIndustryPackage()}

<div class="section">
    <div class="section-title"><span class="num">3</span>기타사항</div>
    <div class="note-box">
        ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
    </div>
</div>
</div>
    ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div></body></html>`;

    showQuotePreview(quoteHTML);
}

// ===== 파견 견적서 (일반 도급 기반) =====
function generateQuoteDispatch() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WW-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-001';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const wage = numVal('hourlyWage') || 10500;
    const baseWage = wage * 209;
    const rPension = (parseFloat(document.getElementById('ratePension').value) || 4.5) / 100;
    const rHealth = (parseFloat(document.getElementById('rateHealth').value) || 3.545) / 100;
    const rEmploy = (parseFloat(document.getElementById('rateEmploy').value) || 0.9) / 100;
    const rIndust = (parseFloat(document.getElementById('rateIndust').value) || 1.5) / 100;
    const rRetire = (parseFloat(document.getElementById('rateRetire').value) || 8.33) / 100;
    const longCare = (parseFloat(document.getElementById('laborLongCare')?.value) || 13.14) / 100;
    const bizTax = (parseFloat(document.getElementById('laborBizTax')?.value) || 0.5) / 100;
    const transport = numVal('laborTransport') || 0;
    const nightPay = numVal('nightPay') || 0;
    const leaderPay = numVal('laborLeaderPay') || 100000;
    const laborMgmtRaw = parseFloat(document.getElementById('laborMgmtFee')?.value);
    const mgmtPct = isNaN(laborMgmtRaw) ? 8 : laborMgmtRaw;

    const pension = Math.round(baseWage * rPension);
    const health = Math.round(baseWage * rHealth);
    const longCareAmt = Math.round(health * longCare);
    const employ = Math.round(baseWage * rEmploy);
    const indust = Math.round(baseWage * rIndust);
    const bizTaxAmt = Math.round(baseWage * bizTax);
    const retire = Math.round(baseWage * rRetire);
    const annualLeave = Math.round(wage * 8);

    const laborSub1 = baseWage + transport + nightPay;
    const laborSub2 = annualLeave;
    const laborTotal = laborSub1 + laborSub2;
    const insuranceTotal = pension + health + longCareAmt + employ + indust + bizTaxAmt;
    const subtotal = laborTotal + insuranceTotal;
    const mgmtAmt = Math.round(subtotal * mgmtPct / 100);
    const perPersonTotal = subtotal + mgmtAmt;

    const s1s = document.getElementById('s1Start').value || '09:00';
    const s1e = document.getElementById('s1End').value || '18:00';

    const workLines = (document.getElementById('workScope').value || '').split('\n').filter(l => l.trim());
    const noteLines = (document.getElementById('dispatchNotes').value || '').split('\n').filter(l => l.trim());

    const quoteHTML = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>파견견적서 - ${client}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>${getQuoteCSS()}</style></head><body>
<div class="document">
${getQuoteHeader('파 견 견 적 서', quoteNum, quoteDate, client + ' 인력 파견', '1인 단가 ' + fmt(perPersonTotal) + '원')}
<div class="body">
${getQuoteParties(client, site || '-', contact)}

<div class="section">
    <div class="section-title"><span class="num">1</span>견적 내용</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">항목</th><th>내용</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">내용</td><td>${client} ${workLines.length > 0 ? workLines[0] : '인력 파견'}</td></tr>
            <tr><td style="text-align:left;">운영시간</td><td>${s1s}~${s1e}</td></tr>
            <tr><td style="text-align:left;">운영장소</td><td>${site || '-'}</td></tr>
            <tr><td style="text-align:left;">인력 근무조건</td><td>일 8시간 근무 기준 (${state.opDays})</td></tr>
            ${workLines.length > 0 ? '<tr><td style="text-align:left;">업무범위</td><td>' + workLines.join(', ') + '</td></tr>' : ''}
        </tbody>
    </table>
</div>

<div class="section">
    <div class="section-title"><span class="num">2</span>운영 예산안 <span style="font-size:11px;font-weight:400;color:#888;">(적용시급: ${fmt(wage)}원) (단위: 원)</span></div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">계정과목</th><th style="text-align:left;">세부내용</th><th>산출내역</th><th style="text-align:right;">합계</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;" rowspan="${2 + (transport > 0 ? 1 : 0) + (nightPay > 0 ? 1 : 0)}"><strong>직접노무비</strong><br>(급여)</td>
                <td style="text-align:left;">기본급</td><td>적용시급×209시간</td><td style="text-align:right;">${fmt(baseWage)}</td></tr>
            ${transport > 0 ? '<tr><td style="text-align:left;">교통비</td><td></td><td style="text-align:right;">' + fmt(transport) + '</td></tr>' : ''}
            ${nightPay > 0 ? '<tr><td style="text-align:left;">야간수당</td><td></td><td style="text-align:right;">' + fmt(nightPay) + '</td></tr>' : ''}
            <tr><td style="text-align:left;"><strong>① 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(laborSub1)}</td></tr>

            <tr><td style="text-align:left;" rowspan="3"></td>
                <td style="text-align:left;">퇴직금</td><td></td><td style="text-align:right;color:#888;">발생시 청구</td></tr>
            <tr><td style="text-align:left;">연차수당</td><td>통상시급×8시간</td><td style="text-align:right;">${fmt(annualLeave)}</td></tr>
            <tr><td style="text-align:left;"><strong>② 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(laborSub2)}</td></tr>

            <tr style="background:#f0f5ff;"><td style="text-align:left;" colspan="2"><strong>③ 합계 (①+②)</strong></td><td></td><td style="text-align:right;font-weight:700;">${fmt(laborTotal)}</td></tr>

            <tr><td style="text-align:left;" rowspan="7"><strong>간접노무비</strong><br>(4대보험)</td>
                <td style="text-align:left;">국민연금</td><td>임금 합계×${(rPension*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(pension)}</td></tr>
            <tr><td style="text-align:left;">건강보험</td><td>임금 합계×${(rHealth*100).toFixed(3)}%</td><td style="text-align:right;">${fmt(health)}</td></tr>
            <tr><td style="text-align:left;">장기요양보험</td><td>건강보험료×${(longCare*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(longCareAmt)}</td></tr>
            <tr><td style="text-align:left;">고용보험</td><td>임금 합계×${(rEmploy*100).toFixed(2)}%</td><td style="text-align:right;">${fmt(employ)}</td></tr>
            <tr><td style="text-align:left;">산재보험</td><td>임금 합계×${(rIndust*100).toFixed(3)}%</td><td style="text-align:right;">${fmt(indust)}</td></tr>
            <tr><td style="text-align:left;">사업소세</td><td>임금 합계×${(bizTax*100).toFixed(1)}%</td><td style="text-align:right;">${fmt(bizTaxAmt)}</td></tr>
            <tr><td style="text-align:left;"><strong>④ 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(insuranceTotal)}</td></tr>

            <tr style="background:#f0f5ff;"><td style="text-align:left;" colspan="2"><strong>⑤ 합계 (③+④)</strong></td><td></td><td style="text-align:right;font-weight:700;">${fmt(subtotal)}</td></tr>

            <tr><td style="text-align:left;"><strong>수수료</strong></td>
                <td style="text-align:left;">파견 수수료</td><td>${mgmtPct}%</td><td style="text-align:right;">${fmt(mgmtAmt)}</td></tr>
        </tbody>
        <tfoot>
            <tr><td style="text-align:left;" colspan="2"><strong>총계 (⑤+수수료) — 1인기준 (VAT 별도)</strong></td><td></td><td style="text-align:right;" class="highlight">${fmt(perPersonTotal)}</td></tr>
            <tr><td style="text-align:left;" colspan="2">월 청구 예상액</td><td></td><td style="text-align:right;color:#888;">실 투입 인원 × 1인 단가 적용</td></tr>
        </tfoot>
    </table>
</div>

${getServiceDescription('dispatch')}
${getIndustryPackage()}

<div class="section">
    <div class="section-title"><span class="num">3</span>기타사항</div>
    <div class="note-box">
        ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
    </div>
</div>
</div>
    ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div></body></html>`;

    showQuotePreview(quoteHTML);
}

// ===== CS대행 견적서 (위드콜) =====
function generateQuoteCSAgent() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WWC-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-001';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const leaderN = parseFloat(document.getElementById('csLeaderCount').value) || 0;
    const leaderS = numVal('csLeaderSalary');
    const seniorN = parseFloat(document.getElementById('csSeniorCount').value) || 0;
    const seniorS = numVal('csSeniorSalary');
    const juniorN = parseFloat(document.getElementById('csJuniorCount').value) || 0;
    const juniorS = numVal('csJuniorSalary');
    const asp = numVal('csASP');
    const csMgmtRaw = parseFloat(document.getElementById('csMgmtFee').value);
    const mgmtPct = isNaN(csMgmtRaw) ? 8 : csMgmtRaw;
    const setupFee = numVal('csSetupFee');
    const opTime = document.getElementById('csOpTime').value || '';
    const workCond = document.getElementById('csWorkCond').value || '';
    const workScope = document.getElementById('csWorkScope').value || '';

    const totalPeople = leaderN + seniorN + juniorN;
    const laborCost = Math.round(leaderN * leaderS + seniorN * seniorS + juniorN * juniorS);
    const aspCost = Math.round(asp * totalPeople);
    const subtotal = laborCost + aspCost;
    const mgmtCost = Math.round(subtotal * mgmtPct / 100);
    const calcTotal = subtotal + mgmtCost;
    const finalPrice = numVal('csAgentFinalPrice') || calcTotal;

    const noteLines = (document.getElementById('csAgentNotes').value || '').split('\n').filter(l => l.trim());

    let peopleRows = '';
    const laborRowCount = (leaderN > 0 ? 1 : 0) + (seniorN > 0 ? 1 : 0) + (juniorN > 0 ? 1 : 0);
    let laborLabelDone = false;
    if (leaderN > 0) { peopleRows += `<tr><td style="text-align:left;"${laborRowCount > 1 ? ' rowspan="'+laborRowCount+'"' : ''}><strong>직·간접<br>노무비</strong></td><td style="text-align:left;">팀장</td><td>${fmt(leaderS)}</td><td>${leaderN}</td><td style="text-align:right;">${fmt(Math.round(leaderN*leaderS))}</td></tr>`; laborLabelDone = true; }
    if (seniorN > 0) { peopleRows += `<tr>${!laborLabelDone ? '<td style="text-align:left;"'+(laborRowCount > 1 ? ' rowspan="'+laborRowCount+'"' : '')+'><strong>직·간접<br>노무비</strong></td>' : ''}<td style="text-align:left;">선임 상담사</td><td>${fmt(seniorS)}</td><td>${seniorN}</td><td style="text-align:right;">${fmt(Math.round(seniorN*seniorS))}</td></tr>`; laborLabelDone = true; }
    if (juniorN > 0) { peopleRows += `<tr>${!laborLabelDone ? '<td style="text-align:left;"><strong>직·간접<br>노무비</strong></td>' : ''}<td style="text-align:left;">일반 상담사</td><td>${fmt(juniorS)}</td><td>${juniorN}</td><td style="text-align:right;">${fmt(Math.round(juniorN*juniorS))}</td></tr>`; }

    const quoteHTML = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>위드콜 견적서 - ${client}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>${getQuoteCSS()}</style></head><body>
<div class="document">
${getQuoteHeader('위드콜 견적서', quoteNum, quoteDate, 'CS대행 서비스', '최종 제안가 ' + fmt(finalPrice) + '원')}
<div class="body">
${getQuoteParties(client, site || '-', contact)}

<div class="section">
    <div class="section-title"><span class="num">1</span>견적 내용</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">항목</th><th>내용</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">내용</td><td>${workScope || client + ' CS 업무'}</td></tr>
            <tr><td style="text-align:left;">운영시간</td><td>${opTime}</td></tr>
            <tr><td style="text-align:left;">인력 근무조건</td><td>${workCond}</td></tr>
            <tr><td style="text-align:left;">업무범위</td><td>${workScope}</td></tr>
        </tbody>
    </table>
</div>

<div class="section">
    <div class="section-title"><span class="num">2</span>운영 예산안 <span style="font-size:11px;font-weight:400;color:#888;">(단위: 원)</span></div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">계정과목</th><th style="text-align:left;">항목</th><th>단가</th><th>인원</th><th style="text-align:right;">합계</th></tr></thead>
        <tbody>
            ${peopleRows}
            <tr style="background:#f7fafc;"><td style="text-align:left;" colspan="3"><strong>① 소계</strong></td><td>${totalPeople}</td><td style="text-align:right;font-weight:600;">${fmt(laborCost)}</td></tr>
            <tr><td style="text-align:left;" rowspan="3"><strong>운영비</strong></td><td style="text-align:left;">ASP 패키지</td><td>${fmt(asp)}</td><td>${totalPeople}</td><td style="text-align:right;">${fmt(aspCost)}</td></tr>
            <tr><td style="text-align:left;">원 운영비</td><td colspan="2" style="text-align:center;color:#888;">발신비용 실비 청구</td><td style="text-align:right;">-</td></tr>
            <tr><td style="text-align:left;"><strong>② 소계</strong></td><td></td><td></td><td style="text-align:right;font-weight:600;">${fmt(aspCost)}</td></tr>
            <tr style="background:#f7fafc;"><td style="text-align:left;" colspan="3"><strong>③ 합계 (①+②)</strong></td><td></td><td style="text-align:right;font-weight:700;">${fmt(subtotal)}</td></tr>
            <tr><td style="text-align:left;"><strong>수수료</strong></td><td style="text-align:left;">관리 수수료</td><td>${mgmtPct}%</td><td></td><td style="text-align:right;">${fmt(mgmtCost)}</td></tr>
        </tbody>
        <tfoot>
            <tr><td style="text-align:left;" colspan="3"><strong>⑤ 총계 (③+④)</strong></td><td></td><td style="text-align:right;" class="highlight">${fmt(calcTotal)}</td></tr>
            ${finalPrice !== calcTotal ? '<tr><td style="text-align:left;" colspan="3"><strong style="color:#e53e3e;">최종 제안가</strong></td><td></td><td style="text-align:right;font-size:16px;font-weight:700;color:#e53e3e;">' + fmt(finalPrice) + '</td></tr>' : ''}
        </tfoot>
    </table>
</div>

${getServiceDescription('cs-agent')}
${getIndustryPackage()}

<div class="section">
    <div class="section-title"><span class="num">3</span>기타사항</div>
    <div class="note-box">
        ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
    </div>
</div>
</div>
    ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div></body></html>`;

    showQuotePreview(quoteHTML);
}

// ===== CS쉐어링 견적서 =====
function generateQuoteCSShare() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WWC-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-001';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const baseFee = numVal('shareBaseFee');
    const baseCall = parseInt(document.getElementById('shareBaseCall').value) || 0;
    const perCall = numVal('sharePerCall');
    const comm = document.getElementById('shareComm').value;
    const opTime = document.getElementById('shareOpTime').value || '';
    const setupFee = numVal('shareSetupFee');
    const workScope = document.getElementById('shareWorkScope').value || '';
    const services = document.getElementById('shareServices').value || '';
    const callStandard = document.getElementById('shareCallStandard').value || '월 ' + baseCall + '건 기준';
    const finalPrice = numVal('csShareFinalPrice') || baseFee;

    const noteLines = (document.getElementById('csShareNotes').value || '').split('\n').filter(l => l.trim());

    const quoteHTML = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>CS쉐어링 견적서 - ${client}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>${getQuoteCSS()}</style></head><body>
<div class="document">
${getQuoteHeader('견 적 서', quoteNum, quoteDate, 'CS쉐어링 서비스 (' + callStandard + ')', '최종 제안가 월 ' + fmt(finalPrice) + '원')}
<div class="body">
${getQuoteParties(client, site || '-', contact)}

<div class="section">
    <div class="section-title"><span class="num">1</span>견적 내용</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">항목</th><th>내용</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">내용</td><td>${workScope || client + ' CS 쉐어링'}</td></tr>
            <tr><td style="text-align:left;">운영시간</td><td>${opTime}</td></tr>
            <tr><td style="text-align:left;">운영 조건</td><td>CS 쉐어 ${callStandard}</td></tr>
            <tr><td style="text-align:left;">업무범위</td><td>${workScope}</td></tr>
        </tbody>
    </table>
</div>

<div class="section">
    <div class="section-title"><span class="num">2</span>운영 예산안 <span style="font-size:11px;font-weight:400;color:#888;">(단위: 원)</span></div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">내용</th><th>1건 당<br>(${callStandard})</th><th style="text-align:right;">금액</th><th>비고</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">기본료</td><td></td><td style="text-align:right;">${fmt(baseFee)}</td><td>${callStandard} 기본료</td></tr>
            <tr><td style="text-align:left;">콜 단가</td><td>${fmt(perCall)}원/건</td><td style="text-align:right;">-</td><td>월 ${baseCall}건 초과 건당<br>${opTime} 근무 기준</td></tr>
            <tr><td style="text-align:left;">통신 비용 (실비 청구)</td><td></td><td style="text-align:right;">-</td><td>${comm === '실비청구' ? '아웃콜 등 실비 발생 시 청구' : '기본료 포함'}</td></tr>
        </tbody>
        <tfoot>
            <tr><td style="text-align:left;"><strong>합계</strong></td><td></td><td style="text-align:right;" class="highlight">${fmt(baseFee)}원~</td><td>VAT 별도</td></tr>
            <tr><td style="text-align:left;"><strong style="color:#e53e3e;">최종 제안가</strong></td><td></td><td style="text-align:right;font-size:16px;font-weight:700;color:#e53e3e;">${fmt(finalPrice)}</td><td>VAT 별도</td></tr>
        </tfoot>
    </table>
</div>

${getServiceDescription('cs-share')}
${getIndustryPackage()}

<div class="section">
    <div class="section-title"><span class="num">3</span>기타사항</div>
    <div class="note-box">
        ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
    </div>
</div>
</div>
    ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div></body></html>`;

    showQuotePreview(quoteHTML);
}

// ===== 유형별 제공 서비스 설명 HTML =====
function getServiceDescription(type) {
    const services = {
        outsource: {
            title: '워크위드 위탁도급 서비스 안내',
            items: [
                { name: '자체 인력 채용·배치', desc: '당사 자체 채용 프로세스를 통한 적합 인력 선발 및 배치' },
                { name: '현장관리자 상시 배치', desc: '품질·근태·안전 관리를 위한 전담 관리자 상주' },
                { name: '교육·훈련 운영', desc: '신입 교육, 서비스 교육, 정기 직무 교육 자체 실시' },
                { name: '결원 즉시 충원', desc: '퇴사·결근 발생 시 당일 대체인력 투입 보장' },
                { name: '4대보험·급여 관리', desc: '근로자 4대보험 가입, 급여 지급, 노무관리 일체 처리' },
                { name: '적법 도급 운영', desc: '독립적 지휘체계·공정분리로 불법파견 리스크 원천 차단' }
            ]
        },
        labor: {
            title: '워크위드 인력 도급 서비스 안내',
            items: [
                { name: '전문 인력 선발', desc: '직무 적합성 평가를 거친 경험 인력 우선 배치' },
                { name: '현장관리자 상시 배치', desc: '품질·근태·안전 관리를 위한 전담 관리자 상주' },
                { name: '4대보험 완비', desc: '국민연금, 건강보험, 고용보험, 산재보험 전원 가입' },
                { name: '결원 즉시 충원', desc: '퇴사·결근 시 당일 대체인력 투입 보장' },
                { name: '자체 교육 체계', desc: '안전교육, 직무교육, 서비스 교육 정기 실시' },
                { name: '적법 도급 운영', desc: '대법원 판례 기준 7대 요소 충족, 8년 무사고 운영' }
            ]
        },
        'cs-agent': {
            title: '위드콜 CS대행 서비스 안내',
            items: [
                { name: '전문 상담사 배치', desc: '서비스 교육 이수 전문 상담사 전담 배치' },
                { name: 'ASP 시스템 제공', desc: 'CTI, 녹취, 통계 등 콜센터 인프라 일체 포함' },
                { name: 'AI 답변 시스템', desc: 'AI 기반 매뉴얼 검색으로 빠르고 정확한 상담 지원' },
                { name: '품질 관리 (QA)', desc: '통화품질 모니터링, 정기 평가, 개선 피드백' },
                { name: '실시간 리포트', desc: '일간/주간/월간 상담 통계 및 VOC 리포트 제공' },
                { name: '유연한 운영', desc: '운영시간·인원 변경 시 협의를 통한 탄력적 대응' }
            ]
        },
        'cs-share': {
            title: '위드콜 CS쉐어링 서비스 안내',
            items: [
                { name: '전문 상담 인프라', desc: '숙련 상담사가 복수 업체를 효율적으로 공유 대응' },
                { name: 'AI 답변 지원', desc: '업체별 매뉴얼 기반 AI 답변 시스템으로 품질 유지' },
                { name: '녹취·DB 제공', desc: '60일 녹취 보관, 주간/월간 상담 리포트 제공' },
                { name: '초과콜 유연 대응', desc: '기본 콜수 초과 시 건당 과금으로 비용 효율적 운영' },
                { name: '소규모 최적화', desc: '전담 상담사 대비 70% 이상 비용 절감 가능' },
                { name: '빠른 시작', desc: '계약 후 1주 이내 운영 시작, 초기 구축 지원' }
            ]
        },
        recruit: {
            title: '워크위드 채용대행 서비스 안내',
            items: [
                { name: '직무분석·공고 작성', desc: '채용 요건 분석 및 맞춤형 채용공고 작성·게시' },
                { name: '이력서 스크리닝', desc: '적합 지원자 1차 서류 심사 및 추천 리스트 제공' },
                { name: '면접 일정 조율', desc: '지원자·담당자 간 면접 스케줄 조율 대행' },
                { name: '수수료 청구 기간', desc: '채용 확정 후 최소 계약기간 동안 월 수수료 청구' },
                { name: '인력풀 보유', desc: '자체 인력 DB 활용으로 빠른 후보자 매칭' },
                { name: '도급 전환 지원', desc: '채용대행 → 인력 도급 전환 시 원스톱 지원 가능' }
            ]
        },
        dispatch: {
            title: '워크위드 인력 파견 서비스 안내',
            items: [
                { name: '전문 인력 선발·파견', desc: '직무 적합성 평가를 거친 경험 인력 파견 배치' },
                { name: '4대보험 완비', desc: '국민연금, 건강보험, 고용보험, 산재보험 전원 가입' },
                { name: '급여·노무 관리', desc: '파견근로자 급여 지급, 4대보험, 노무관리 일체 처리' },
                { name: '결원 즉시 충원', desc: '퇴사·결근 시 당일 대체인력 투입 보장' },
                { name: '자체 교육 체계', desc: '안전교육, 직무교육, 서비스 교육 정기 실시' },
                { name: '파견법 준수', desc: '파견근로자보호법에 따른 적법한 운영 체계 보장' }
            ]
        }
    };

    const svc = services[type];
    if (!svc) return '';

    return `
<div class="section">
    <div class="section-title"><span class="num">&#9733;</span>${svc.title}</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;width:180px;">서비스 항목</th><th style="text-align:left;">내용</th></tr></thead>
        <tbody>
            ${svc.items.map(item => '<tr><td style="text-align:left;font-weight:600;">' + item.name + '</td><td style="text-align:left;">' + item.desc + '</td></tr>').join('')}
        </tbody>
    </table>
    <div class="note-box" style="margin-top:8px;">
        <p style="font-size:11px;color:#888;">주식회사 워크위드 | 근로자파견사업 허가업체 | 8년 무사고 운영 | TEL 1600-9878</p>
    </div>
</div>`;
}

// ===== 업종별 문제-해결책 패키징 HTML =====
function getIndustryPackage() {
    const industry = document.getElementById('industry').value;
    if (!industry) return '';

    // 하위 호환: 사무/CS → 사무/행정
    const key = industry === '사무/CS' ? '사무/행정' : industry;

    const packages = {
        '세차/주차': {
            title: '세차/주차 업종 맞춤 솔루션',
            items: [
                { pain: '잦은 퇴사로 인력 공백 발생', solution: '자체 인력풀 보유, 당일 대체인력 투입 보장' },
                { pain: '서비스 품질 편차가 큼', solution: '입사 전 서비스 마인드 교육 + 정기 CS교육 실시' },
                { pain: '직접 고용 시 4대보험·노무 부담', solution: '당사가 4대보험·급여·노무관리 일체 처리' },
                { pain: '성수기/비수기 인원 조절 어려움', solution: '탄력배치 운영으로 비수기 비용 절감' }
            ]
        },
        '물류/택배': {
            title: '물류/택배 업종 맞춤 솔루션',
            items: [
                { pain: '야간·새벽 근무자 확보 어려움', solution: '야간 전문 인력 보유, 수당 포함 단가 제시' },
                { pain: '물량 변동에 따른 인력 유동성 필요', solution: '일·주 단위 증감 가능한 탄력 운영 체계' },
                { pain: '산재사고 리스크 높음', solution: '안전교육 의무 실시 + 산재보험 완비' },
                { pain: '인력 관리에 시간·비용 과다 소모', solution: '현장관리자 상주 배치, 근태·품질 일괄 관리' }
            ]
        },
        '제조라인': {
            title: '제조 라인 업종 맞춤 솔루션',
            items: [
                { pain: '불법파견 판정 리스크', solution: '독립 지휘체계·공정분리로 적법도급 운영 (8년 무사고)' },
                { pain: '생산라인 중단 시 매출 손실', solution: '결원 발생 당일 대체인력 투입, 라인 중단 최소화' },
                { pain: '신규 인력 숙련도 낮음', solution: '자체 직무교육 프로그램으로 투입 전 사전 교육' },
                { pain: '근로감독 대응 어려움', solution: '적법운영안내서 제공 + 근로감독 공동 대응' }
            ]
        },
        '사무/행정': {
            title: '사무/행정 업종 맞춤 솔루션',
            items: [
                { pain: '채용 후 조기 퇴사 반복', solution: '적합성 검증 후 배치 + 조기퇴사 시 즉시 교체' },
                { pain: '전문 인력 채용 비용 부담', solution: '도급 전환으로 채용·교육·관리 비용 일괄 절감' },
                { pain: '업무 표준화·인수인계 어려움', solution: '매뉴얼 기반 업무 정립 + 체계적 인수인계 지원' },
                { pain: '단기 프로젝트 인력 필요', solution: '기간 맞춤 인력 배치, 계약기간 자유 설정' }
            ]
        },
        'CS/콜센터': {
            title: 'CS/콜센터 업종 맞춤 솔루션',
            items: [
                { pain: '자체 콜센터 운영비 과다 (CTI·녹취 등)', solution: 'ASP 시스템 일체 포함, 별도 인프라 비용 없음' },
                { pain: '상담 품질 관리가 안 됨', solution: 'QA 전담 + AI 답변 시스템으로 정확도 향상' },
                { pain: '상담원 채용·교육 부담', solution: '전문 상담사 직접 채용·교육 후 배치' },
                { pain: '상담 데이터 활용 못함', solution: '일간/주간 VOC 리포트 + 녹취 DB 제공' }
            ]
        },
        '이커머스': {
            title: '이커머스 업종 맞춤 솔루션',
            items: [
                { pain: '고객 문의·반품·교환 응대에 시간 소모', solution: '전문 상담사가 CS 전반 대행 처리' },
                { pain: 'CS 매뉴얼이 없어 응대 품질 들쭉날쭉', solution: '업체별 맞춤 매뉴얼 구축 + AI 답변 시스템 연동' },
                { pain: 'CS 때문에 마케팅·상품에 집중 못함', solution: 'CS 통합 대행으로 핵심 업무 집중 환경 제공' },
                { pain: '1인·소규모 셀러는 전담 상담사 부담', solution: '쉐어링 방식으로 소규모도 전문 CS 이용 가능' }
            ]
        },
        '경비/시설': {
            title: '경비/시설관리 업종 맞춤 솔루션',
            items: [
                { pain: '24시간 교대근무 인력 확보 난항', solution: '격일근무·3교대 전문 인력 보유' },
                { pain: '고령 인력 관리 어려움', solution: '체력·적합성 평가 후 배치 + 정기 건강관리' },
                { pain: '야간 근무 중 사고 리스크', solution: '안전교육 정기 실시 + 산재보험 완비' },
                { pain: '경비 인력 서비스 마인드 부족', solution: '입주민 응대 교육 + 서비스 마인드 정기 교육' }
            ]
        },
        '호텔/숙박': {
            title: '호텔/숙박 업종 맞춤 솔루션',
            items: [
                { pain: '서비스 품질이 곧 매출에 직결', solution: '호텔 서비스 전문교육 이수 인력 배치' },
                { pain: '객실 청소·프론트 인력 잦은 이탈', solution: '자체 인력풀 활용 당일 충원 보장' },
                { pain: '성수기/비수기 인력 수급 불균형', solution: '시즌별 탄력배치 + 비수기 비용 최적화' },
                { pain: '외국어 가능 인력 부족', solution: '외국어 가능 인력 우선 매칭 서비스' }
            ]
        },
        '식품제조': {
            title: '식품 제조 업종 맞춤 솔루션',
            items: [
                { pain: '위생관리 기준 미충족 시 영업정지', solution: '위생교육 의무화 + HACCP 기준 준수 관리' },
                { pain: '생산량 변동에 따른 인력 유동성 필요', solution: '일·주 단위 인원 증감 가능 탄력 운영' },
                { pain: '불법파견 판정 리스크', solution: '독립 공정분리 + 적법운영안내서 제출' },
                { pain: '제조 경험 인력 확보 어려움', solution: '식품제조 경험자 인력풀 보유 + 사전 교육' }
            ]
        },
        '기타': {
            title: '워크위드 맞춤 솔루션',
            items: [
                { pain: '인력 채용·관리에 시간 소모', solution: '채용부터 관리까지 원스톱 아웃소싱' },
                { pain: '인건비 외 부수 비용(4대보험 등) 부담', solution: '복리후생비·4대보험 포함 단가, 추가비용 없음' },
                { pain: '갑작스러운 결원 대응 어려움', solution: '자체 인력풀 활용 당일 대체 투입 보장' },
                { pain: '노무 리스크(근로감독 등) 부담', solution: '적법 운영 + 노무사 자문 지원' }
            ]
        }
    };

    const pkg = packages[key];
    if (!pkg) return '';

    return `
<div class="section" style="page-break-inside:avoid;">
    <div class="section-title"><span class="num">&#9733;</span>${pkg.title}</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;width:220px;">업종 고민</th><th style="text-align:left;">워크위드 솔루션</th></tr></thead>
        <tbody>
            ${pkg.items.map(item => '<tr><td style="text-align:left;color:#c53030;">' + item.pain + '</td><td style="text-align:left;font-weight:600;">' + item.solution + '</td></tr>').join('')}
        </tbody>
    </table>
</div>`;
}

// ===== 채용대행 견적서 =====
function generateQuoteRecruit() {
    const client = document.getElementById('clientName').value || '(업체명)';
    const site = document.getElementById('siteName').value || '';
    const contact = document.getElementById('contactName').value || '';
    const quoteNum = document.getElementById('quoteNumber').value || 'WW-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-001';
    const quoteDate = document.getElementById('quoteDate').value || formatKoreanDate(new Date());

    const opTime = document.getElementById('recruitOpTime').value || '';
    const workCond = document.getElementById('recruitWorkCond').value || '';
    const workScope = document.getElementById('recruitWorkScope').value || '';
    const feeRate = parseFloat(document.getElementById('recruitFeeRate').value) || 8;
    const minMonth = parseInt(document.getElementById('recruitMinMonth').value) || 3;
    const finalPrice = numVal('recruitFinalPrice');

    // 직무 행 수집
    const rows = document.getElementById('recruitRows').querySelectorAll('tr');
    let peopleRows = '';
    let totalPeople = 0;
    let totalLabor = 0;
    let rowIdx = 0;

    rows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        const selects = row.querySelectorAll('select');
        if (inputs.length < 3) return;
        const jobName = inputs[0].value || '(직무)';
        const career = selects.length > 0 ? selects[0].value : '신입';
        const salary = numElVal(inputs[1]);
        const count = parseInt(inputs[2].value) || 0;
        const subtotal = salary * count;
        totalPeople += count;
        totalLabor += subtotal;

        const rowspanAttr = rowIdx === 0 ? ' rowspan="' + rows.length + '"' : '';
        const labelCell = rowIdx === 0 ? '<td style="text-align:left;"' + rowspanAttr + '><strong>인건비</strong></td>' : '';

        peopleRows += `<tr>${labelCell}<td style="text-align:left;">${jobName}(${career})</td><td>${fmt(salary)}</td><td>${count}</td><td style="text-align:right;">${fmt(subtotal)}</td></tr>`;
        rowIdx++;
    });

    const fee = Math.round(totalLabor * feeRate / 100);
    const calcTotal = totalLabor + fee;

    const noteLines = (document.getElementById('recruitNotes').value || '').split('\n').filter(l => l.trim());

    const quoteHTML = `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>채용대행 견적서 - ${client}</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>${getQuoteCSS()}</style></head><body>
<div class="document">
${getQuoteHeader('채용대행 견적서', quoteNum, quoteDate, '채용대행 서비스', '월 ' + fmt(finalPrice || calcTotal) + '원')}
<div class="body">
${getQuoteParties(client, site || '-', contact)}

<div class="section">
    <div class="section-title"><span class="num">1</span>견적 내용</div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">항목</th><th>내용</th></tr></thead>
        <tbody>
            <tr><td style="text-align:left;">운영형태</td><td>채용대행</td></tr>
            <tr><td style="text-align:left;">운영시간</td><td>${opTime}</td></tr>
            <tr><td style="text-align:left;">운영장소</td><td>귀사 지정 장소</td></tr>
            <tr><td style="text-align:left;">인력 근무조건</td><td>${workCond}</td></tr>
            <tr><td style="text-align:left;">업무범위</td><td>${workScope}</td></tr>
        </tbody>
    </table>
    <p style="font-size:11px;color:#888;margin-top:6px;">※ 운영 및 업무관련 범위 설정은 상호 합의 하에 추가되거나 변경될 수 있음.</p>
</div>

<div class="section">
    <div class="section-title"><span class="num">2</span>운영 예산안 <span style="font-size:11px;font-weight:400;color:#888;">(단위: 원)</span></div>
    <table class="qt">
        <thead><tr><th style="text-align:left;">계정과목</th><th style="text-align:left;">항목</th><th>단가</th><th>인원</th><th style="text-align:right;">합계</th></tr></thead>
        <tbody>
            ${peopleRows}
            <tr style="background:#f7fafc;"><td style="text-align:left;" colspan="3"><strong>① 소계</strong></td><td>${totalPeople}</td><td style="text-align:right;font-weight:600;">${fmt(totalLabor)}</td></tr>
            <tr><td style="text-align:left;"><strong>수수료</strong></td><td style="text-align:left;">소개수수료</td><td>${feeRate}%</td><td></td><td style="text-align:right;">${fmt(fee)}</td></tr>
            <tr style="background:#f7fafc;"><td style="text-align:left;" colspan="3"><strong>② 소계</strong></td><td></td><td style="text-align:right;font-weight:600;">${fmt(fee)}</td></tr>
        </tbody>
        <tfoot>
            <tr><td style="text-align:left;" colspan="3"><strong>합계 (①+②) (VAT 별도)</strong></td><td></td><td style="text-align:right;" class="highlight">${fmt(calcTotal)}</td></tr>
            ${(finalPrice && finalPrice !== calcTotal) ? '<tr><td style="text-align:left;" colspan="3"><strong style="color:#e53e3e;">최종 제안가</strong></td><td></td><td style="text-align:right;font-size:16px;font-weight:700;color:#e53e3e;">' + fmt(finalPrice) + '</td></tr>' : ''}
        </tfoot>
    </table>
</div>

${getServiceDescription('recruit')}
${getIndustryPackage()}

<div class="section">
    <div class="section-title"><span class="num">3</span>기타사항</div>
    <div class="note-box">
        ${noteLines.map((l,i) => '<p>'+(i+1)+'. '+l.trim()+'</p>').join('')}
    </div>
</div>
</div>
    ${getQuoteSignature()}
<div class="footer">워크위드 | 본 견적서는 견적일로부터 30일간 유효합니다.</div>
</div></body></html>`;

    showQuotePreview(quoteHTML);
}

function printQuote() {
    if (!state.quoteHTML) {
        alert('먼저 견적서를 생성해주세요.');
        return;
    }
    const blob = new Blob([state.quoteHTML], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const w = window.open(url, '_blank');
    setTimeout(() => { w.print(); URL.revokeObjectURL(url); }, 800);
}

// ===== 체크리스트 =====
function toggleCheck(li) {
    li.classList.toggle('checked');
    const idx = Array.from(li.parentElement.children).indexOf(li);
    state.checklist[idx] = li.classList.contains('checked');

    const checked = state.checklist.filter(c => c).length;
    const total = state.checklist.length;
    document.getElementById('progressFill').style.width = (checked/total*100) + '%';
    document.getElementById('progressText').textContent = checked + ' / ' + total + ' 완료';

    // 탭에 완료 표시
    document.querySelectorAll('.tab-btn')[5].querySelector('.tab-num').textContent = checked + '/' + total;

    autoSave();
}

// ===== 자동 저장 =====
function autoSave() {
    // 모든 입력값 수집
    const data = {
        clientName: elVal('clientName'),
        siteName: elVal('siteName'),
        industry: elVal('industry'),
        contactName: elVal('contactName'),
        contactPhone: elVal('contactPhone'),
        contactEmail: elVal('contactEmail'),
        reason: elVal('reason'),
        memo: elVal('memo'),
        perShift: elVal('perShift'),
        hourlyWage: elVal('hourlyWage'),
        nightPay: elVal('nightPay'),
        etcCost: elVal('etcCost'),
        simQuote1: elVal('simQuote1'),
        simQuote2: elVal('simQuote2'),
        simQuote3: elVal('simQuote3'),
        itemDogup: elVal('itemDogup'),
        itemManage: elVal('itemManage'),
        itemAdmin: elVal('itemAdmin'),
        quoteNumber: elVal('quoteNumber'),
        quoteDate: elVal('quoteDate'),
        workScope: elVal('workScope'),
        quoteNotes: elVal('quoteNotes'),
        outsourceNotes: elVal('outsourceNotes'),
        laborNotes: elVal('laborNotes'),
        recruitNotes: elVal('recruitNotes'),
        dispatchNotes: elVal('dispatchNotes'),
        finalPrice: elVal('finalPrice'),
        lessonMemo: elVal('lessonMemo'),
        ratePension: elVal('ratePension'),
        rateHealth: elVal('rateHealth'),
        rateEmploy: elVal('rateEmploy'),
        rateIndust: elVal('rateIndust'),
        rateRetire: elVal('rateRetire'),
        rateNight: elVal('rateNight'),
        nightStart: elVal('nightStart'),
        nightEnd: elVal('nightEnd'),
        s1Start: elVal('s1Start'),
        s1End: elVal('s1End'),
        s1OT: elVal('s1OT'),
        s2Start: elVal('s2Start'),
        s2End: elVal('s2End'),
        s2OT: elVal('s2OT'),
        s3Start: elVal('s3Start'),
        s3End: elVal('s3End'),
        s3OT: elVal('s3OT'),
        shiftCount: state.shiftCount || 2,
        // CS대행 필드
        csLeaderCount: elVal('csLeaderCount'),
        csLeaderSalary: elVal('csLeaderSalary'),
        csSeniorCount: elVal('csSeniorCount'),
        csSeniorSalary: elVal('csSeniorSalary'),
        csJuniorCount: elVal('csJuniorCount'),
        csJuniorSalary: elVal('csJuniorSalary'),
        csASP: elVal('csASP'),
        csMgmtFee: elVal('csMgmtFee'),
        csSetupFee: elVal('csSetupFee'),
        csOpTime: elVal('csOpTime'),
        csWorkCond: elVal('csWorkCond'),
        csWorkScope: elVal('csWorkScope'),
        csAgentFinalPrice: elVal('csAgentFinalPrice'),
        csAgentNotes: elVal('csAgentNotes'),
        // CS쉐어링 필드
        shareBaseCall: elVal('shareBaseCall'),
        shareBaseFee: elVal('shareBaseFee'),
        sharePerCall: elVal('sharePerCall'),
        shareComm: elVal('shareComm'),
        shareOpTime: elVal('shareOpTime'),
        shareSetupFee: elVal('shareSetupFee'),
        shareCallStandard: elVal('shareCallStandard'),
        shareWorkScope: elVal('shareWorkScope'),
        shareServices: elVal('shareServices'),
        csShareFinalPrice: elVal('csShareFinalPrice'),
        csShareNotes: elVal('csShareNotes'),
        // 일반도급 필드
        laborMgmtFee: document.getElementById('laborMgmtFee')?.value || '8',
        laborTransport: document.getElementById('laborTransport')?.value || '100000',
        laborLeaderPay: document.getElementById('laborLeaderPay')?.value || '100000',
        laborBizTax: document.getElementById('laborBizTax')?.value || '0.5',
        laborLongCare: document.getElementById('laborLongCare')?.value || '13.14',
        // 채용대행 필드
        recruitOpTime: document.getElementById('recruitOpTime')?.value || '',
        recruitWorkCond: document.getElementById('recruitWorkCond')?.value || '',
        recruitWorkScope: document.getElementById('recruitWorkScope')?.value || '',
        recruitFeeRate: document.getElementById('recruitFeeRate')?.value || '8',
        recruitMinMonth: document.getElementById('recruitMinMonth')?.value || '3',
        recruitFinalPrice: document.getElementById('recruitFinalPrice')?.value || '',
        // 채용대행 직무 행 데이터
        personnelOverride: document.getElementById('personnelOverride')?.value || '',
        // 채용대행 직무 행 데이터
        recruitRowsData: (() => {
            const rows = document.getElementById('recruitRows')?.querySelectorAll('tr') || [];
            const arr = [];
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                const selects = row.querySelectorAll('select');
                if (inputs.length >= 3) {
                    arr.push({
                        job: inputs[0].value,
                        career: selects.length > 0 ? selects[0].value : '신입',
                        salary: inputs[1].value,
                        count: inputs[2].value
                    });
                }
            });
            return arr;
        })(),
        state: state,
        savedAt: new Date().toISOString()
    };

    localStorage.setItem('ww_quote_current', JSON.stringify(data));

    // 저장 상태 표시
    const saveStatusEl = document.getElementById('saveStatus');
    if (saveStatusEl) saveStatusEl.textContent = '저장됨 ' + new Date().toLocaleTimeString('ko-KR', {hour:'2-digit',minute:'2-digit'});
}

function loadSaved() {
    const saved = localStorage.getItem('ww_quote_current');
    if (!saved) { showHistory(); return; }
    const data = JSON.parse(saved);

    // 하위 호환: 사무/CS → 사무/행정
    if (data.industry === '사무/CS') data.industry = '사무/행정';

    // 필드 복원
    const fields = ['clientName','siteName','industry','contactName','contactPhone','contactEmail',
        'reason','memo','perShift','hourlyWage','nightPay','etcCost',
        'simQuote1','simQuote2','simQuote3','itemDogup','itemManage','itemAdmin',
        'quoteNumber','quoteDate','workScope','quoteNotes','outsourceNotes','laborNotes','recruitNotes','dispatchNotes','finalPrice','lessonMemo',
        'ratePension','rateHealth','rateEmploy','rateIndust','rateRetire','rateNight',
        'nightStart','nightEnd',
        's1Start','s1End','s1OT','s2Start','s2End','s2OT','s3Start','s3End','s3OT',
        'csLeaderCount','csLeaderSalary','csSeniorCount','csSeniorSalary','csJuniorCount','csJuniorSalary',
        'csASP','csMgmtFee','csSetupFee','csOpTime','csWorkCond','csWorkScope','csAgentFinalPrice','csAgentNotes',
        'shareBaseCall','shareBaseFee','sharePerCall','shareComm','shareOpTime','shareSetupFee',
        'shareCallStandard','shareWorkScope','shareServices','csShareFinalPrice','csShareNotes',
        'laborMgmtFee','laborTransport','laborLeaderPay','laborBizTax','laborLongCare',
        'recruitOpTime','recruitWorkCond','recruitWorkScope','recruitFeeRate','recruitMinMonth','recruitFinalPrice',
        'personnelOverride'];

    fields.forEach(id => {
        const el = document.getElementById(id);
        if (el && data[id] !== undefined) el.value = data[id];
    });

    // 채용대행 직무 행 복원
    if (data.recruitRowsData && data.recruitRowsData.length > 0) {
        const tbody = document.getElementById('recruitRows');
        if (tbody) {
            tbody.innerHTML = '';
            data.recruitRowsData.forEach(r => addRecruitRow(r.job, r.career, r.salary, r.count));
        }
    }

    // 상태 복원
    if (data.state) {
        state = data.state;
        // 옵션 버튼 복원
        restoreOptions('source', state.source);
        restoreOptions('currentOps', state.currentOps);
        restoreOptions('opDays', state.opDays);
        restoreOptions('manager', state.manager);
        restoreOptions('result', state.result);

        // 견적 유형 복원
        if (state.quoteType) {
            switchQuoteType(state.quoteType, null);
            document.querySelectorAll('.type-card').forEach(c => {
                const types = { outsource: '정액제 도급', labor: '일반 도급', dispatch: '파견', 'cs-agent': 'CS대행', 'cs-share': 'CS쉐어링', recruit: '채용대행' };
                if (c.querySelector('.type-name').textContent === types[state.quoteType]) c.classList.add('selected');
                else c.classList.remove('selected');
            });
        }

        // 교대수 복원
        const sc = state.shiftCount || (state.shiftPreset ? (shiftPresets[state.shiftPreset]?.show3 ? 3 : shiftPresets[state.shiftPreset]?.shifts || 2) : 2);
        setShiftCount(sc, null, true);

        // 시간 필드는 이미 복원되었으므로 다시 안 건드림 (setShiftCount가 빈 값 초기화하지 않도록 fromPreset=true)

        // 체크리스트 복원
        if (state.checklist) {
            document.querySelectorAll('.checklist li').forEach((li, i) => {
                if (state.checklist[i]) {
                    li.classList.add('checked');
                }
            });
            const checked = state.checklist.filter(c => c).length;
            document.getElementById('progressFill').style.width = (checked/10*100) + '%';
            document.getElementById('progressText').textContent = checked + ' / 10 완료';
        }
    }

    // 금액 필드 콤마 포맷팅
    fmtAllMoney();

    calcPersonnel();
    calcCost();
    if (state.quoteType === 'cs-agent') calcCSAgent();
    if (state.quoteType === 'cs-share') calcCSShare();
    if (state.quoteType === 'recruit') calcRecruit();

    alert('불러왔습니다. (저장 시간: ' + new Date(data.savedAt).toLocaleString('ko-KR') + ')');
}

function restoreOptions(group, value) {
    if (!value) return;
    document.querySelectorAll('.option-btn').forEach(btn => {
        const parent = btn.parentElement;
        // 같은 그룹의 버튼인지 확인 (간이)
        if (btn.textContent.trim() === value) {
            const siblings = parent.querySelectorAll('.option-btn');
            // 같은 그룹인지 추정
            siblings.forEach(s => {
                if (getGroup(s) === group) s.classList.remove('selected');
            });
            if (getGroup(btn) === group) btn.classList.add('selected');
        }
    });
}

function getGroup(btn) {
    const onclick = btn.getAttribute('onclick') || '';
    const match = onclick.match(/selectOption\(this,'(\w+)'\)/);
    return match ? match[1] : '';
}

function resetAll() {
    if (!confirm('현재 데이터를 모두 초기화하시겠습니까?\n(이전 데이터는 브라우저에 남아있습니다)')) return;

    // 현재 데이터 백업
    const backup = localStorage.getItem('ww_quote_current');
    if (backup) {
        const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
        history.push(JSON.parse(backup));
        if (history.length > 20) history.shift(); // 최대 20개
        localStorage.setItem('ww_quote_history', JSON.stringify(history));
    }

    // 초기화
    document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(el => {
        if (el.id === 'hourlyWage') el.value = '10,500';
        else if (el.id === 'perShift') el.value = '4';
        else if (el.id === 'etcCost') el.value = '1,000,000';
        else if (el.id === 'ratePension') el.value = '4.5';
        else if (el.id === 'rateHealth') el.value = '3.545';
        else if (el.id === 'rateEmploy') el.value = '0.9';
        else if (el.id === 'rateIndust') el.value = '1.5';
        else if (el.id === 'rateRetire') el.value = '8.33';
        else if (el.id === 'rateNight') el.value = '50';
        else if (el.className.includes('scenario-input')) {}
        else el.value = '';
    });

    document.querySelectorAll('.option-btn.selected').forEach(b => b.classList.remove('selected'));
    document.querySelectorAll('.checklist li.checked').forEach(li => li.classList.remove('checked'));

    state = { quoteType:'outsource', source:'', currentOps:'', opDays:'주7일', shifts:'2교대', manager:'1명 배치', result:'', shiftPreset:'service', shiftCount:2, checklist:[false,false,false,false,false,false,false,false,false,false] };
    switchQuoteType('outsource', document.querySelector('.type-card'));

    // 기본 선택 복원
    document.querySelectorAll('.option-btn').forEach(btn => {
        if (['주7일','1명 배치','서비스업'].includes(btn.textContent.trim())) {
            btn.classList.add('selected');
        }
    });

    // 교대 프리셋 기본값 복원
    applyShiftPreset('service', document.querySelector('.option-btn.selected'));

    document.getElementById('progressFill').style.width = '0%';
    document.getElementById('progressText').textContent = '0 / 10 완료';
    document.getElementById('quotePreview').innerHTML = '';

    switchTab(0);
    autoSave();
}

// ===== 유틸리티 =====
function fmt(n) {
    return Math.round(n).toLocaleString('ko-KR');
}

function fmtMan(n) {
    return Math.round(n / 10000).toLocaleString('ko-KR');
}

function numToKorean(n) {
    const units = ['', '만', '억'];
    const nums = ['영', '일', '이', '삼', '사', '오', '육', '칠', '팔', '구'];
    const subUnits = ['', '십', '백', '천'];

    if (n === 0) return '영';
    let result = '';
    let unitIdx = 0;

    while (n > 0) {
        let part = n % 10000;
        if (part > 0) {
            let partStr = '';
            let subIdx = 0;
            while (part > 0) {
                let digit = part % 10;
                if (digit > 0) {
                    partStr = (digit === 1 && subIdx > 0 ? '' : nums[digit]) + subUnits[subIdx] + partStr;
                }
                part = Math.floor(part / 10);
                subIdx++;
            }
            result = partStr + units[unitIdx] + result;
        }
        n = Math.floor(n / 10000);
        unitIdx++;
    }
    return result;
}

function formatKoreanDate(d) {
    return d.getFullYear() + '년 ' + (d.getMonth()+1) + '월 ' + d.getDate() + '일';
}

// ===== 요율 설정 토글 =====
function toggleRates() {
    document.getElementById('rateSettings').classList.toggle('open');
}

// ===== 이력 저장 =====
function saveToHistory() {
    const client = elVal('clientName') || '(미입력)';
    const site = elVal('siteName') || '';
    if (client === '(미입력)' && !site) {
        if (!confirm('업체명이 비어있습니다. 그래도 저장하시겠습니까?')) return;
    }

    // 현재 데이터 수집 (autoSave와 동일)
    autoSave();
    const current = JSON.parse(localStorage.getItem('ww_quote_current') || '{}');

    // 견적 금액 계산
    const d = parseInt(elVal('itemDogup')) || 0;
    const m = parseInt(elVal('itemManage')) || 0;
    const a = parseInt(elVal('itemAdmin')) || 0;
    const quoteAmount = (d + m + a) * 10000;

    // 유형별 인원 계산
    let metaPersonnel = 0;
    const qt = state.quoteType || 'outsource';
    if (qt === 'cs-agent') {
        metaPersonnel = (parseFloat(elVal('csLeaderCount')) || 0)
            + (parseFloat(elVal('csSeniorCount')) || 0)
            + (parseFloat(elVal('csJuniorCount')) || 0);
    } else if (qt === 'recruit') {
        const recruitEl = document.getElementById('recruitRows');
        if (recruitEl) {
            recruitEl.querySelectorAll('tr').forEach(row => {
                metaPersonnel += parseInt(row.querySelectorAll('input')[2]?.value) || 0;
            });
        }
    } else if (qt !== 'cs-share') {
        metaPersonnel = state.personnel || 0;
    }

    // 이력에 추가 메타 정보 붙이기
    current._meta = {
        client: client,
        site: site,
        industry: elVal('industry') || '',
        quoteType: qt,
        quoteAmount: quoteAmount,
        totalCost: state.totalCost || 0,
        personnel: metaPersonnel,
        result: state.result || 'Pending (진행중)',
        savedAt: new Date().toISOString()
    };

    // 이력 배열에 추가
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    history.push(current);
    if (history.length > 50) history.shift(); // 최대 50건
    localStorage.setItem('ww_quote_history', JSON.stringify(history));

    alert('이력에 저장되었습니다. (' + client + ' ' + site + ')');
}

// ===== 이력 조회 =====
function showHistory() {
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    const container = document.getElementById('historyList');

    if (history.length === 0) {
        container.innerHTML = '<div class="history-empty">저장된 견적 이력이 없습니다.<br>상단 [저장] 버튼을 눌러 이력을 쌓아보세요.</div>';
    } else {
        let html = '<div style="font-size:12px;color:#718096;margin-bottom:12px;">총 ' + history.length + '건</div>';

        // 최신순으로 표시
        for (let i = history.length - 1; i >= 0; i--) {
            const item = history[i];
            const meta = item._meta || {};
            const client = meta.client || item.clientName || '(미입력)';
            const site = meta.site || item.siteName || '';
            const amount = meta.quoteAmount || 0;
            const result = meta.result || '';
            const savedAt = meta.savedAt || item.savedAt || '';
            const dateStr = savedAt ? new Date(savedAt).toLocaleDateString('ko-KR', {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'}) : '';

            let badgeHTML = '';
            if (result.includes('Win')) badgeHTML = '<span class="history-badge badge-win">Win</span>';
            else if (result.includes('Loss')) badgeHTML = '<span class="history-badge badge-loss">Loss</span>';
            else if (result.includes('Pending')) badgeHTML = '<span class="history-badge badge-pending">진행중</span>';

            html += '<div class="history-item">';
            html += '  <div class="history-info">';
            html += '    <div class="history-client" id="hc-' + i + '" ondblclick="editHistoryField(' + i + ',\'client\')">' + client + ' ' + site + badgeHTML + '</div>';
            const typeNames = { outsource:'정액제', labor:'일반도급', dispatch:'파견', 'cs-agent':'CS대행', 'cs-share':'쉐어링', recruit:'채용대행' };
            const typeName = typeNames[meta.quoteType] || '';
            html += '    <div class="history-meta">' + dateStr + (typeName ? ' | ' + typeName : '') + (meta.industry ? ' | ' + meta.industry : '') + (meta.personnel ? ' | ' + meta.personnel + '명' : '') + '</div>';
            html += '  </div>';
            html += '  <div class="history-amount" id="ha-' + i + '" ondblclick="editHistoryField(' + i + ',\'amount\')">' + (amount > 0 ? fmt(amount) + '원' : '-') + '</div>';
            html += '  <div class="history-actions">';
            html += '    <button class="btn-load" onclick="loadFromHistory(' + i + ')">불러오기</button>';
            html += '    <button class="btn-edit" onclick="editHistoryField(' + i + ',\'client\')" title="수정" style="background:#edf2f7;color:#4a5568;font-size:11px;padding:4px 8px;border:none;border-radius:4px;cursor:pointer;">수정</button>';
            html += '    <button class="btn-del" onclick="deleteHistory(' + i + ')">삭제</button>';
            html += '  </div>';
            html += '</div>';
        }
        container.innerHTML = html;
    }

    document.getElementById('historyModal').classList.add('active');
}

function closeHistory() {
    document.getElementById('historyModal').classList.remove('active');
}

// ===== 이력 불러오기 =====
function loadFromHistory(idx) {
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    if (idx < 0 || idx >= history.length) return;

    if (!confirm('현재 작업 중인 데이터를 덮어씁니다. 계속하시겠습니까?')) return;

    const data = history[idx];

    // 하위 호환: 사무/CS → 사무/행정
    if (data.industry === '사무/CS') data.industry = '사무/행정';

    // 필드 복원
    const fields = ['clientName','siteName','industry','contactName','contactPhone','contactEmail',
        'reason','memo','perShift','hourlyWage','nightPay','etcCost',
        'simQuote1','simQuote2','simQuote3','itemDogup','itemManage','itemAdmin',
        'quoteNumber','quoteDate','workScope','quoteNotes','outsourceNotes','laborNotes','recruitNotes','dispatchNotes','finalPrice','lessonMemo',
        'ratePension','rateHealth','rateEmploy','rateIndust','rateRetire','rateNight',
        'nightStart','nightEnd',
        's1Start','s1End','s1OT','s2Start','s2End','s2OT','s3Start','s3End','s3OT',
        'csLeaderCount','csLeaderSalary','csSeniorCount','csSeniorSalary','csJuniorCount','csJuniorSalary',
        'csASP','csMgmtFee','csSetupFee','csOpTime','csWorkCond','csWorkScope','csAgentFinalPrice','csAgentNotes',
        'shareBaseCall','shareBaseFee','sharePerCall','shareComm','shareOpTime','shareSetupFee',
        'shareCallStandard','shareWorkScope','shareServices','csShareFinalPrice','csShareNotes',
        'laborMgmtFee','laborTransport','laborLeaderPay','laborBizTax','laborLongCare',
        'recruitOpTime','recruitWorkCond','recruitWorkScope','recruitFeeRate','recruitMinMonth','recruitFinalPrice',
        'personnelOverride'];

    fields.forEach(id => {
        const el = document.getElementById(id);
        if (el && data[id] !== undefined) el.value = data[id];
    });

    // 채용대행 직무 행 복원
    if (data.recruitRowsData && data.recruitRowsData.length > 0) {
        const tbody = document.getElementById('recruitRows');
        if (tbody) {
            tbody.innerHTML = '';
            data.recruitRowsData.forEach(r => addRecruitRow(r.job, r.career, r.salary, r.count));
        }
    }

    // 상태 복원
    if (data.state) {
        state = data.state;
        restoreOptions('source', state.source);
        restoreOptions('currentOps', state.currentOps);
        restoreOptions('opDays', state.opDays);
        restoreOptions('manager', state.manager);
        restoreOptions('result', state.result);

        // 견적 유형 복원
        if (state.quoteType) {
            switchQuoteType(state.quoteType, null);
            document.querySelectorAll('.type-card').forEach(c => {
                const types = { outsource: '정액제 도급', labor: '일반 도급', dispatch: '파견', 'cs-agent': 'CS대행', 'cs-share': 'CS쉐어링', recruit: '채용대행' };
                if (c.querySelector('.type-name').textContent === types[state.quoteType]) c.classList.add('selected');
                else c.classList.remove('selected');
            });
        }

        // 교대수 복원
        const sc = state.shiftCount || (state.shiftPreset ? (shiftPresets[state.shiftPreset]?.show3 ? 3 : shiftPresets[state.shiftPreset]?.shifts || 2) : 2);
        setShiftCount(sc, null, true);

        if (state.checklist) {
            document.querySelectorAll('.checklist li').forEach((li, i) => {
                li.classList.toggle('checked', !!state.checklist[i]);
            });
            const checked = state.checklist.filter(c => c).length;
            document.getElementById('progressFill').style.width = (checked/10*100) + '%';
            document.getElementById('progressText').textContent = checked + ' / 10 완료';
        }
    }

    calcPersonnel();
    calcCost();
    if (state.quoteType === 'cs-agent') calcCSAgent();
    if (state.quoteType === 'cs-share') calcCSShare();
    if (state.quoteType === 'recruit') calcRecruit();
    closeHistory();
    switchTab(0);

    alert('불러왔습니다. (' + (data._meta?.client || data.clientName || '') + ')');
}

// ===== 이력 삭제 =====
function editHistoryField(idx, field) {
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    if (idx < 0 || idx >= history.length) return;
    const item = history[idx];
    const meta = item._meta || {};

    if (field === 'client') {
        const el = document.getElementById('hc-' + idx);
        const curClient = meta.client || item.clientName || '';
        const curSite = meta.site || item.siteName || '';
        el.innerHTML = '<div style="display:flex;flex-direction:column;gap:4px;">'
            + '<input type="text" id="heClient-' + idx + '" value="' + curClient.replace(/"/g,'&quot;') + '" placeholder="업체명" style="font-size:13px;padding:4px 8px;border:1px solid #cbd5e0;border-radius:4px;width:140px;">'
            + '<input type="text" id="heSite-' + idx + '" value="' + curSite.replace(/"/g,'&quot;') + '" placeholder="현장명" style="font-size:13px;padding:4px 8px;border:1px solid #cbd5e0;border-radius:4px;width:140px;">'
            + '<div style="display:flex;gap:4px;"><button onclick="saveHistoryField(' + idx + ',\'client\')" style="font-size:11px;padding:3px 10px;background:#4299e1;color:#fff;border:none;border-radius:4px;cursor:pointer;">저장</button>'
            + '<button onclick="showHistory()" style="font-size:11px;padding:3px 10px;background:#e2e8f0;color:#4a5568;border:none;border-radius:4px;cursor:pointer;">취소</button></div></div>';
        document.getElementById('heClient-' + idx).focus();
    } else if (field === 'amount') {
        const el = document.getElementById('ha-' + idx);
        const curAmount = meta.quoteAmount || 0;
        el.innerHTML = '<div style="display:flex;flex-direction:column;gap:4px;">'
            + '<input type="text" inputmode="numeric" data-money id="heAmount-' + idx + '" value="' + (curAmount ? parseInt(curAmount).toLocaleString('ko-KR') : '0') + '" style="font-size:13px;padding:4px 8px;border:1px solid #cbd5e0;border-radius:4px;width:120px;text-align:right;">'
            + '<div style="display:flex;gap:4px;"><button onclick="saveHistoryField(' + idx + ',\'amount\')" style="font-size:11px;padding:3px 10px;background:#4299e1;color:#fff;border:none;border-radius:4px;cursor:pointer;">저장</button>'
            + '<button onclick="showHistory()" style="font-size:11px;padding:3px 10px;background:#e2e8f0;color:#4a5568;border:none;border-radius:4px;cursor:pointer;">취소</button></div></div>';
        document.getElementById('heAmount-' + idx).focus();
    }
}

function saveHistoryField(idx, field) {
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    if (idx < 0 || idx >= history.length) return;
    if (!history[idx]._meta) history[idx]._meta = {};

    if (field === 'client') {
        const newClient = document.getElementById('heClient-' + idx).value.trim();
        const newSite = document.getElementById('heSite-' + idx).value.trim();
        history[idx]._meta.client = newClient;
        history[idx]._meta.site = newSite;
        history[idx].clientName = newClient;
        history[idx].siteName = newSite;
    } else if (field === 'amount') {
        const newAmount = parseInt(String(document.getElementById('heAmount-' + idx).value).replace(/,/g,'')) || 0;
        history[idx]._meta.quoteAmount = newAmount;
    }

    localStorage.setItem('ww_quote_history', JSON.stringify(history));
    showHistory();
}

function deleteHistory(idx) {
    const history = JSON.parse(localStorage.getItem('ww_quote_history') || '[]');
    if (idx < 0 || idx >= history.length) return;

    const meta = history[idx]._meta || {};
    const name = (meta.client || '(미입력)') + ' ' + (meta.site || '');
    if (!confirm(name.trim() + ' 이력을 삭제하시겠습니까?')) return;

    history.splice(idx, 1);
    localStorage.setItem('ww_quote_history', JSON.stringify(history));
    showHistory(); // 새로고침
}

// ===== 구글시트 연동 =====
const APPS_SCRIPT_CODE = `function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);

    // 테스트 요청 처리
    if (data._test) {
      return ContentService.createTextOutput(JSON.stringify({success: true, message: '연결 성공'}))
        .setMimeType(ContentService.MimeType.JSON);
    }

    // 목록 조회 (POST)
    if (data._action === 'list') {
      var ss2 = SpreadsheetApp.getActiveSpreadsheet();
      var sh2 = ss2.getSheetByName('견적관리');
      if (!sh2) return ContentService.createTextOutput(JSON.stringify({success:true, data:[]})).setMimeType(ContentService.MimeType.JSON);
      var lastRow = sh2.getLastRow();
      if (lastRow < 2) return ContentService.createTextOutput(JSON.stringify({success:true, data:[]})).setMimeType(ContentService.MimeType.JSON);
      var vals = sh2.getRange(2, 1, lastRow - 1, 18).getValues();
      var list = vals.map(function(r, i) {
        return {row: i+2, date:r[0], quoteType:r[1], clientName:r[2], siteName:r[3],
          industry:r[4], contactName:r[5], personnel:r[10], quoteAmount:r[12],
          finalPrice:r[14], result:r[15], fileUrl:r[17]};
      });
      return ContentService.createTextOutput(JSON.stringify({success:true, data:list})).setMimeType(ContentService.MimeType.JSON);
    }

    // 개별 로드 (POST)
    if (data._action === 'load') {
      var ss3 = SpreadsheetApp.getActiveSpreadsheet();
      var sh3 = ss3.getSheetByName('견적관리');
      var fullData = sh3.getRange(parseInt(data._row), 19).getValue();
      return ContentService.createTextOutput(JSON.stringify({success:true, row:parseInt(data._row), fullData:fullData})).setMimeType(ContentService.MimeType.JSON);
    }

    var ss = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getSheetByName('견적관리');
    if (!sheet) {
      sheet = ss.insertSheet('견적관리');
      var headers = ['날짜','견적유형','업체명','사업장','업종','담당자','연락처','이메일',
        '유입경로','현재운영','인원','원가(원)','견적금액(원)','마진율(%)','최종제안가(원)','결과','메모','견적서링크','전체데이터'];
      sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
      sheet.getRange(1, 1, 1, headers.length).setFontWeight('bold').setBackground('#1a365d').setFontColor('#fff');
      sheet.setFrozenRows(1);
      sheet.setColumnWidth(19, 50); // 전체데이터 열 좁게
    }

    // 견적서 HTML을 구글 드라이브에 저장
    var fileUrl = '';
    if (data._quoteHtml) {
      var folder = DriveApp.getRootFolder();
      var folders = DriveApp.getFoldersByName('견적서');
      if (folders.hasNext()) { folder = folders.next(); }
      else { folder = DriveApp.createFolder('견적서'); }
      var fileName = (data.clientName || '미입력') + '_' + (data.siteName || '') + '_' + (data.date || '').replace(/\\./g,'') + '.html';
      var file = folder.createFile(fileName, data._quoteHtml, 'text/html');
      file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
      fileUrl = file.getUrl();
    }

    // 수정 모드: 기존 행 업데이트
    if (data._updateRow) {
      var rowNum = parseInt(data._updateRow);
      var row = [data.date||'',data.quoteType||'',data.clientName||'',data.siteName||'',
        data.industry||'',data.contactName||'',data.contactPhone||'',data.contactEmail||'',
        data.source||'',data.currentOps||'',data.personnel||'',data.totalCost||'',
        data.quoteAmount||'',data.marginRate||'',data.finalPrice||'',data.result||'',
        data.memo||'',fileUrl||sheet.getRange(rowNum,18).getValue(),data._fullData||''];
      sheet.getRange(rowNum, 1, 1, row.length).setValues([row]);
      sheet.getRange(rowNum, 12).setNumberFormat('#,##0');
      sheet.getRange(rowNum, 13).setNumberFormat('#,##0');
      sheet.getRange(rowNum, 15).setNumberFormat('#,##0');
      return ContentService.createTextOutput(JSON.stringify({success:true, row:rowNum, updated:true}))
        .setMimeType(ContentService.MimeType.JSON);
    }

    // 새 행 추가
    var row = [data.date||'',data.quoteType||'',data.clientName||'',data.siteName||'',
      data.industry||'',data.contactName||'',data.contactPhone||'',data.contactEmail||'',
      data.source||'',data.currentOps||'',data.personnel||'',data.totalCost||'',
      data.quoteAmount||'',data.marginRate||'',data.finalPrice||'',data.result||'',
      data.memo||'',fileUrl,data._fullData||''];
    sheet.appendRow(row);
    var lastRow = sheet.getLastRow();
    sheet.getRange(lastRow, 12).setNumberFormat('#,##0');
    sheet.getRange(lastRow, 13).setNumberFormat('#,##0');
    sheet.getRange(lastRow, 15).setNumberFormat('#,##0');

    return ContentService.createTextOutput(JSON.stringify({success:true, row:lastRow}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch(err) {
    return ContentService.createTextOutput(JSON.stringify({success:false, error:err.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  var action = (e && e.parameter && e.parameter.action) || 'list';
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName('견적관리');
  if (!sheet) {
    return ContentService.createTextOutput(JSON.stringify({success:false, error:'시트 없음'}))
      .setMimeType(ContentService.MimeType.JSON);
  }

  // 목록 조회
  if (action === 'list') {
    var lastRow = sheet.getLastRow();
    if (lastRow < 2) {
      return ContentService.createTextOutput(JSON.stringify({success:true, data:[]}))
        .setMimeType(ContentService.MimeType.JSON);
    }
    var range = sheet.getRange(2, 1, lastRow - 1, 18); // 전체데이터 제외
    var values = range.getValues();
    var list = values.map(function(r, i) {
      return {row: i+2, date:r[0], quoteType:r[1], clientName:r[2], siteName:r[3],
        industry:r[4], contactName:r[5], personnel:r[10], quoteAmount:r[12],
        finalPrice:r[14], result:r[15], fileUrl:r[17]};
    });
    return ContentService.createTextOutput(JSON.stringify({success:true, data:list}))
      .setMimeType(ContentService.MimeType.JSON);
  }

  // 개별 로드 (전체 데이터)
  if (action === 'load') {
    var rowNum = parseInt(e.parameter.row);
    var fullData = sheet.getRange(rowNum, 19).getValue();
    return ContentService.createTextOutput(JSON.stringify({success:true, row:rowNum, fullData:fullData}))
      .setMimeType(ContentService.MimeType.JSON);
  }

  return ContentService.createTextOutput(JSON.stringify({success:false, error:'알 수 없는 action'}))
    .setMimeType(ContentService.MimeType.JSON);
}`;

function getSheetUrl() {
    return localStorage.getItem('ww_sheet_url') || '';
}

function saveSheetSettings() {
    const url = document.getElementById('sheetWebAppUrl').value.trim();
    localStorage.setItem('ww_sheet_url', url);
}

function openSheetModal() {
    document.getElementById('sheetWebAppUrl').value = getSheetUrl();
    document.getElementById('sheetTestResult').style.display = 'none';
    document.getElementById('sheetModal').classList.add('active');
}

function closeSheetModal() {
    document.getElementById('sheetModal').classList.remove('active');
}

function copyAppsScript() {
    navigator.clipboard.writeText(APPS_SCRIPT_CODE).then(() => {
        const msg = document.getElementById('scriptCopyMsg');
        msg.style.display = 'inline';
        setTimeout(() => msg.style.display = 'none', 2000);
    });
}

function gasPost(url, payload) {
    return fetch(url, {
        method: 'POST',
        body: JSON.stringify(payload),
        redirect: 'follow'
    })
    .then(r => r.text())
    .then(text => {
        console.log('GAS 응답:', text.substring(0, 200));
        try { return JSON.parse(text); } catch(e) {
            if (text.includes('</html>')) throw new Error('HTML 응답 수신 - Apps Script 배포 설정을 확인해주세요');
            throw new Error('응답 파싱 실패: ' + text.substring(0, 100));
        }
    });
}

function testSheetConnection() {
    const url = getSheetUrl();
    const resultEl = document.getElementById('sheetTestResult');
    if (!url) {
        resultEl.innerHTML = '<span style="color:#e53e3e;">URL을 먼저 입력해주세요.</span>';
        resultEl.style.display = 'block';
        return;
    }
    resultEl.innerHTML = '<span style="color:#718096;">테스트 중...</span>';
    resultEl.style.display = 'block';

    gasPost(url, { _test: true })
    .then(data => {
        if (data.success) {
            resultEl.innerHTML = '<span style="color:#38a169;">연결 성공! 구글시트 전송이 준비되었습니다.</span>';
        } else {
            resultEl.innerHTML = '<span style="color:#e53e3e;">오류: ' + (data.error || '알 수 없는 오류') + '</span>';
        }
    })
    .catch(err => {
        resultEl.innerHTML = '<span style="color:#e53e3e;">연결 실패: ' + err.message + '</span>';
    });
}

function elVal(id) { const el = document.getElementById(id); return el ? el.value || '' : ''; }

function collectSheetData() {
    const qt = state.quoteType || 'outsource';
    const typeNames = { outsource:'정액제 도급', labor:'일반 도급', dispatch:'파견', 'cs-agent':'CS대행', 'cs-share':'CS쉐어링', recruit:'채용대행' };

    let personnel = 0;
    if (qt === 'cs-agent') {
        personnel = (parseFloat(elVal('csLeaderCount')) || 0)
            + (parseFloat(elVal('csSeniorCount')) || 0)
            + (parseFloat(elVal('csJuniorCount')) || 0);
    } else if (qt === 'recruit') {
        const rows = document.getElementById('recruitRows');
        if (rows) rows.querySelectorAll('tr').forEach(row => {
            personnel += parseInt(row.querySelectorAll('input')[2]?.value) || 0;
        });
    } else if (qt !== 'cs-share') {
        personnel = state.personnel || 0;
    }

    let quoteAmount = 0, finalPrice = 0, totalCost = 0;
    if (qt === 'cs-agent') {
        totalCost = parseInt(document.getElementById('csAgentTotal')?.textContent?.replace(/[^0-9]/g,'')) || 0;
        finalPrice = numVal('csAgentFinalPrice');
        quoteAmount = finalPrice || totalCost;
    } else if (qt === 'cs-share') {
        finalPrice = numVal('csShareFinalPrice');
        const baseFee = numVal('shareBaseFee');
        quoteAmount = finalPrice || baseFee;
        totalCost = baseFee;
    } else if (qt === 'recruit') {
        finalPrice = numVal('recruitFinalPrice');
        quoteAmount = finalPrice;
    } else {
        const d = parseInt(elVal('itemDogup')) || 0;
        const m = parseInt(elVal('itemManage')) || 0;
        const a = parseInt(elVal('itemAdmin')) || 0;
        quoteAmount = (d + m + a) * 10000;
        totalCost = state.totalCost || 0;
        finalPrice = numVal('finalPrice');
        if (finalPrice) finalPrice = finalPrice * 10000;
    }

    let marginRate = '';
    if (quoteAmount > 0 && totalCost > 0) {
        marginRate = ((quoteAmount - totalCost) / quoteAmount * 100).toFixed(1);
    }

    return {
        date: new Date().toLocaleDateString('ko-KR', {year:'numeric', month:'2-digit', day:'2-digit'}),
        quoteType: typeNames[qt] || qt,
        clientName: elVal('clientName'),
        siteName: elVal('siteName'),
        industry: elVal('industry'),
        contactName: elVal('contactName'),
        contactPhone: elVal('contactPhone'),
        contactEmail: elVal('contactEmail'),
        source: state.source || '',
        currentOps: state.currentOps || '',
        personnel: personnel,
        totalCost: totalCost,
        quoteAmount: quoteAmount,
        marginRate: marginRate,
        finalPrice: finalPrice || quoteAmount,
        result: state.result || 'Pending (진행중)',
        memo: elVal('memo')
    };
}

function sendToGoogleSheet() {
  try {
    const url = getSheetUrl();
    if (!url) {
        openSheetModal();
        return;
    }
    const clientName = elVal('clientName');
    if (!clientName) {
        if (!confirm('업체명이 비어있습니다. 그래도 전송하시겠습니까?')) return;
    }

    const data = collectSheetData();

    // autoSave 데이터 전체를 JSON으로 첨부 (나중에 불러오기용)
    autoSave();
    const saved = JSON.parse(localStorage.getItem('ww_quote_current') || '{}');
    // quoteHTML은 별도 Drive 파일로 저장하므로 fullData에서 제거 (셀 크기 초과 방지)
    if (saved.state) delete saved.state.quoteHTML;
    data._fullData = JSON.stringify(saved);

    // 견적서 HTML 첨부 → 구글드라이브에 파일로 저장됨
    if (state.quoteHTML) {
        data._quoteHtml = state.quoteHTML;
    }

    // 수정 모드면 행 번호 첨부
    if (state._sheetRow) {
        data._updateRow = state._sheetRow;
    }

    // 전송 중 표시
    const saveStatus = document.getElementById('saveStatus');
    const prevText = saveStatus ? saveStatus.textContent : '';
    if (saveStatus) { saveStatus.textContent = '구글시트 전송 중...'; saveStatus.style.color = '#63b3ed'; }

    gasPost(url, data)
    .then(result => {
        if (result.success) {
            state._sheetRow = result.row;
            if (saveStatus) { saveStatus.textContent = result.updated ? '구글시트 수정 완료!' : '구글시트 저장 완료!'; saveStatus.style.color = '#68d391'; setTimeout(() => { saveStatus.textContent = prevText; saveStatus.style.color = ''; }, 3000); }
            alert(result.updated ? '구글시트 행 ' + result.row + ' 수정 완료!' : '구글시트에 저장되었습니다. (행 ' + result.row + ')');
        } else {
            if (saveStatus) { saveStatus.textContent = '전송 실패'; saveStatus.style.color = '#fc8181'; setTimeout(() => { saveStatus.textContent = prevText; saveStatus.style.color = ''; }, 3000); }
            alert('전송 실패: ' + (result.error || '알 수 없는 오류'));
        }
    })
    .catch(err => {
        if (saveStatus) { saveStatus.textContent = '전송 실패'; saveStatus.style.color = '#fc8181'; setTimeout(() => { saveStatus.textContent = prevText; saveStatus.style.color = ''; }, 3000); }
        alert('전송 오류: ' + err.message + '\n\nApps Script URL을 확인해주세요.');
        openSheetModal();
    });
  } catch(e) {
    alert('sendToGoogleSheet 에러: ' + e.message);
  }
}

// ===== 구글시트에서 불러오기 =====
function showSheetHistory() {
    const url = getSheetUrl();
    if (!url) { openSheetModal(); return; }

    const container = document.getElementById('historyList');
    container.innerHTML = '<div style="text-align:center;padding:30px;color:#718096;">구글시트에서 불러오는 중...</div>';
    document.getElementById('historyModal').classList.add('active');

    gasPost(url, { _action: 'list' })
    .then(result => {
        if (!result.success) throw new Error(result.error || '조회 실패');
        renderSheetHistory(result.data);
    })
    .catch(err => {
        container.innerHTML = '<div style="text-align:center;padding:30px;color:#e53e3e;">구글시트 조회 실패: ' + err.message + '<br><br><span style="font-size:12px;color:#718096;">로컬 이력을 보려면 [로컬이력] 버튼을 사용하세요.</span></div>';
    });
}

function renderSheetHistory(list) {
    const container = document.getElementById('historyList');
    if (!list || list.length === 0) {
        container.innerHTML = '<div class="history-empty">구글시트에 저장된 견적이 없습니다.<br>견적 작성 후 [구글시트] 버튼으로 저장하세요.</div>';
        return;
    }

    let html = '<div style="font-size:12px;color:#718096;margin-bottom:12px;">구글시트 총 ' + list.length + '건</div>';

    // 최신순
    for (let i = list.length - 1; i >= 0; i--) {
        const item = list[i];
        const amount = item.quoteAmount || item.finalPrice || 0;

        let badgeHTML = '';
        const result = item.result || '';
        if (result.includes('Win')) badgeHTML = '<span class="history-badge badge-win">Win</span>';
        else if (result.includes('Loss')) badgeHTML = '<span class="history-badge badge-loss">Loss</span>';
        else badgeHTML = '<span class="history-badge badge-pending">진행중</span>';

        html += '<div class="history-item">';
        html += '  <div class="history-info">';
        html += '    <div class="history-client">' + (item.clientName || '(미입력)') + ' ' + (item.siteName || '') + badgeHTML + '</div>';
        html += '    <div class="history-meta">' + (item.date || '') + ' | ' + (item.quoteType || '') + (item.industry ? ' | ' + item.industry : '') + (item.personnel ? ' | ' + item.personnel + '명' : '') + '</div>';
        html += '  </div>';
        html += '  <div class="history-amount">' + (amount > 0 ? fmt(amount) + '원' : '-') + '</div>';
        html += '  <div class="history-actions">';
        html += '    <button class="btn-load" onclick="loadFromSheet(' + item.row + ')">불러오기</button>';
        if (item.fileUrl) html += '    <a href="' + item.fileUrl + '" target="_blank" style="padding:4px 10px;border-radius:4px;border:1px solid #4299e1;color:#4299e1;font-size:11px;text-decoration:none;display:inline-block;">견적서</a>';
        html += '  </div>';
        html += '</div>';
    }
    container.innerHTML = html;
}

function loadFromSheet(rowNum) {
    const url = getSheetUrl();
    if (!url) return;

    if (!confirm('현재 작업 중인 데이터를 덮어씁니다. 계속하시겠습니까?')) return;

    gasPost(url, { _action: 'load', _row: rowNum })
    .then(result => {
        if (!result.success) throw new Error(result.error || '로드 실패');

        // fullData JSON으로 복원
        const data = JSON.parse(result.fullData);
        localStorage.setItem('ww_quote_current', result.fullData);
        loadSaved();
        state._sheetRow = rowNum; // 수정용 행 번호 기억

        // 견적서 미리보기 복원
        if (state.quoteHTML) {
            showQuotePreview(state.quoteHTML);
            // 견적서 탭으로 자동 전환
            const tabs = document.querySelectorAll('.tab-btn');
            if (tabs[4]) tabs[4].click();
        }

        closeHistory();
        alert('구글시트에서 불러왔습니다. (행 ' + rowNum + ')\n수정 후 [구글시트 저장] 버튼을 누르면 같은 행이 업데이트됩니다.');
    })
    .catch(err => {
        alert('불러오기 실패: ' + err.message);
    });
}

// ===== 초기화 =====
window.addEventListener('DOMContentLoaded', function() {
    // 견적번호 기본값
    const today = new Date();
    const dateStr = today.toISOString().slice(0,10).replace(/-/g,'');
    document.getElementById('quoteNumber').value = 'WW-' + dateStr + '-01';
    document.getElementById('quoteDate').value = formatKoreanDate(today);

    // 저장된 데이터 자동 복원
    const saved = localStorage.getItem('ww_quote_current');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            // 오늘 날짜와 같은 날 저장된 것만 자동 복원
            const savedDate = new Date(data.savedAt).toDateString();
            if (savedDate === today.toDateString()) {
                loadSaved();
                fmtAllMoney();
                return;
            }
        } catch(e) { console.warn('loadSaved 오류:', e); }
    }

    // 초기 계산
    fmtAllMoney();
    switchQuoteType('outsource', document.querySelector('.type-card'));
    calcPersonnel();
    calcCost();
});
</script>

</body>
</html>
